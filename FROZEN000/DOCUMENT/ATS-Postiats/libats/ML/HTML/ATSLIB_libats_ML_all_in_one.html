<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    .patsyntax {color:#808080;background-color:#E0E0E0;}
    .patsyntax span.keyword {color:#000000;font-weight:bold;}
    .patsyntax span.comment {color:#787878;font-style:italic;}
    .patsyntax span.extcode {color:#A52A2A;}
    .patsyntax span.neuexp  {color:#800080;}
    .patsyntax span.staexp  {color:#0000F0;}
    .patsyntax span.prfexp  {color:#603030;}
    .patsyntax span.dynexp  {color:#F00000;}
    .patsyntax span.stalab  {color:#0000F0;font-style:italic}
    .patsyntax span.dynlab  {color:#F00000;font-style:italic}
    .patsyntax span.dynstr  {color:#008000;font-style:normal}
    .patsyntax span.stacstdec  {text-decoration:none;}
    .patsyntax span.stacstuse  {color:#0000CF;text-decoration:underline;}
    .patsyntax span.dyncstdec  {text-decoration:none;}
    .patsyntax span.dyncstuse  {color:#B80000;text-decoration:underline;}
    .patsyntax span.dyncst_implement  {color:#B80000;text-decoration:underline;}
  </style>
</head>
<body class="patsyntax">

<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// For supporting ML-style of functional programming</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file: Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: June, 2012</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_PACKNAME "ATSLIB.libats"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cfun0<span class="keyword">(</span><span class="staexp">b<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun1<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun2<span class="keyword">(</span><span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cfun3 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun4 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a4<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">,</span> <span class="staexp">a4</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun5 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a4<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a5<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">,</span> <span class="staexp">a4</span><span class="keyword">,</span> <span class="staexp">a5</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun6 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a4<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a5<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a6<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">,</span> <span class="staexp">a4</span><span class="keyword">,</span> <span class="staexp">a5</span><span class="keyword">,</span> <span class="staexp">a6</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun7 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a4<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a5<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a6<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a7<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">,</span> <span class="staexp">a4</span><span class="keyword">,</span> <span class="staexp">a5</span><span class="keyword">,</span> <span class="staexp">a6</span><span class="keyword">,</span> <span class="staexp">a7</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun8 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a4<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a5<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a6<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a7<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a8<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">,</span> <span class="staexp">a4</span><span class="keyword">,</span> <span class="staexp">a5</span><span class="keyword">,</span> <span class="staexp">a6</span><span class="keyword">,</span> <span class="staexp">a7</span><span class="keyword">,</span> <span class="staexp">a8</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cfun9 <span class="keyword">(</span>
  <span class="staexp">a1<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a4<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a5<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a6<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a7<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a8<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">a9<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">b<span class="keyword">:</span>vt0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">,</span> <span class="staexp">a4</span><span class="keyword">,</span> <span class="staexp">a5</span><span class="keyword">,</span> <span class="staexp">a6</span><span class="keyword">,</span> <span class="staexp">a7</span><span class="keyword">,</span> <span class="staexp">a8</span><span class="keyword">,</span> <span class="staexp">a9</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun0</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun1</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun2</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun3</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun4</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun5</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun6</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun7</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun8</span></span>
<span class="keyword">stadef</span> <span class="staexp">cfun <span class="keyword">=</span> <span class="staexp">cfun9</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// t0ype+: covariant</span>
<span class="comment">// vt0ype+: covariant</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="staexp">list0_t0ype_type
<span class="keyword">(</span>
  a<span class="keyword">:</span> <span class="keyword">t0ype+</span>
<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">list0_nil <span class="keyword">of</span>
      <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">list0_cons <span class="keyword">of</span>
      <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list0_t0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
    <span class="comment">// end of [list0_cons]</span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="staexp">list0_vt0ype_vtype
<span class="keyword">(</span>
  a<span class="keyword">:</span> <span class="keyword">vt0ype+</span>
<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">list0_vt_nil <span class="keyword">of</span>
      <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">list0_vt_cons <span class="keyword">of</span>
      <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list0_vt0ype_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
    <span class="comment">// end of [list0_vt_cons]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> nil0 list0_nil</span>
<span class="neuexp"><span class="keyword">#define</span> cons0 list0_cons</span>
<span class="neuexp"><span class="keyword">#define</span> nil0_vt list0_vt_nil</span>
<span class="neuexp"><span class="keyword">#define</span> cons0_vt list0_vt_cons</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">list0<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">list0_t0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">list0_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">list0_vt0ype_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// t0ype+: covariant</span>
<span class="comment">// vt0ype+: covariant</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="staexp">option0_t0ype_type
<span class="keyword">(</span>
  a<span class="keyword">:</span> <span class="keyword">t0ype+</span>
<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">None0 <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp">Some0 <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="staexp">option0_vt0ype_vtype
<span class="keyword">(</span>
  a<span class="keyword">:</span> <span class="keyword">vt0ype+</span>
<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">None0_vt <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp">Some0_vt <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">option0<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">option0_t0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">option0_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">option0_vt0ype_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
array0_vt0ype_type
  <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt0ype</span><span class="comment">(*invariant*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">array0
<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">array0_vt0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
abstype
subarray0_vt0ype_type
  (a: vt0ype(*invariant*)) = ptr
stadef subarray0 = subarray0_vt0ype_type
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
matrix0_vt0ype_type
  <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt0ype</span><span class="comment">(*invariant*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">matrix0
<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">matrix0_vt0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span> strarr_type <span class="keyword">=</span> ptr</span>
<span class="keyword">typedef</span> <span class="staexp">strarr <span class="keyword">=</span> <span class="staexp">strarr_type</span></span>
<span class="comment">//</span>
<span class="comment">(*
abstype substrarr_type = ptr
typedef substrarr = substrarr_type
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
dynarray_type<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt0ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">dynarray<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">dynarray_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// for elements of type (a)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
hashtbl_type
<span class="keyword">(</span>key<span class="keyword">:</span><span class="keyword">t0ype</span><span class="keyword">,</span> itm<span class="keyword">:</span><span class="keyword">t0ype+</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">hashtbl
<span class="keyword">(</span> <span class="staexp">key<span class="keyword">:</span><span class="keyword">t0ype</span></span>
<span class="keyword">,</span> <span class="staexp">itm<span class="keyword">:</span><span class="keyword">t0ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">hashtbl_type</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2015-12-01:</span>
<span class="comment">// G-values for generic programming</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">datatype</span> <span class="staexp">gvalue <span class="keyword">=</span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVnil <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVint <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVptr <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">ptr</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVbool <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">bool</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">GVchar <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVfloat <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVstring <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVref <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">gvref</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVlist <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">gvlist</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVarray <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">gvarray</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVdynarr <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">gvdynarr</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVhashtbl <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">gvhashtbl</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">GVfunclo_fun <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">(</span><span class="staexp">gvalue</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">gvalue</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">GVfunclo_clo <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">(</span><span class="staexp">gvalue</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">gvalue</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">where</span>
<span class="staexp">gvref <span class="keyword">=</span> <span class="staexp">ref</span><span class="keyword">(</span><span class="staexp">gvalue</span><span class="keyword">)</span></span>
<span class="keyword">and</span>
<span class="staexp">gvlist <span class="keyword">=</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">gvalue</span><span class="keyword">)</span></span>
<span class="keyword">and</span>
<span class="staexp">gvarray <span class="keyword">=</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">gvalue</span><span class="keyword">)</span></span>
<span class="keyword">and</span>
<span class="staexp">gvdynarr <span class="keyword">=</span> <span class="staexp">dynarray</span><span class="keyword">(</span><span class="staexp">gvalue</span><span class="keyword">)</span></span>
<span class="keyword">and</span>
<span class="staexp">gvhashtbl <span class="keyword">=</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">gvalue</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
typedef gvopt = Option(gvalue)
vtypedef gvopt_vt = Option_vt(gvalue)
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [basis.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2011-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: May, 2012 *)</span>
<span class="comment">(* Authoremail: gmmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-01:</span>
<span class="comment">// A rule of thumb for effect-annotation is that</span>
<span class="comment">// higher-order functions should not be annotated!</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
typedef SHR(a:type) = a // for commenting purpose
typedef NSH(a:type) = a // for commenting purpose
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> nil0 list0_nil</span>
<span class="neuexp"><span class="keyword">#define</span> cons0 list0_cons</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
list0_sing<span class="keyword">(</span>x<span class="keyword">)</span>
list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
list0_pair<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
list0_cons<span class="keyword">(</span>x1<span class="keyword">,</span> list0_cons<span class="keyword">(</span>x2<span class="keyword">,</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
list0_cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
g0ofg1_list
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
g1ofg0_list
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">List0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_list</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_list</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
list0_of_list
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
list0_of_list_vt
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_0<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_1<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_2<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_3<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_4
  <span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_5
  <span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tuple_6
  <span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x5<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> list0_tuple</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_0</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_1</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_2</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_3</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_4</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_5</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_tuple <span class="keyword">with</span> list0_tuple_6</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_make_sing<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_make_pair<span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_make_elt<span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> list0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_make_arrpsz<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>psz<span class="keyword">:</span> <span class="staexp">arrpsz</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> list0 <span class="keyword">with</span> list0_make_arrpsz</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
list0_make_intrange_lr
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
list0_make_intrange_lrd
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> list0_make_intrange</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_make_intrange <span class="keyword">with</span> list0_make_intrange_lr</span>
<span class="dynexp"><span class="keyword">overload</span>
list0_make_intrange <span class="keyword">with</span> list0_make_intrange_lrd</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_is_nil<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_is_cons<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_is_empty<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_isnot_empty<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> list0_is_empty</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> list0_isnot_empty</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_length
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> list0_length <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>length <span class="keyword">with</span> list0_length <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_head_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_head_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tail_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tail_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> head <span class="keyword">with</span> list0_head_exn <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> tail <span class="keyword">with</span> list0_tail_exn <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> head_opt <span class="keyword">with</span> list0_head_opt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> tail_opt <span class="keyword">with</span> list0_tail_opt <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head <span class="keyword">with</span> list0_head_exn <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail <span class="keyword">with</span> list0_tail_exn <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head_opt <span class="keyword">with</span> list0_head_opt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail_opt <span class="keyword">with</span> list0_tail_opt <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_last_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_last_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_init_exn
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_init_opt
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_nth_exn
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_nth_opt
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_get_at_exn
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_get_at_opt
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> list0_get_at_exn</span> <span class="comment">// ListSubscriptExn</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_fset_at_exn
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_fset_at_opt
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_fexch_at_exn
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_fexch_at_opt
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
print_list0<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
prerr_list0<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_list0
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_list0]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_list0_sep
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">string</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_list0_sep]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_list0</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_list0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_list0</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_list0_sep</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_listlist0_sep
<span class="keyword">(</span> out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> xss<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">string</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_list0_sep]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_listlist0_sep</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_insert_at_exn
<span class="keyword">(</span>
  <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_remove_at_exn
  <span class="keyword">(</span><span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_remove_at_exn]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_takeout_at_exn
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> remove_at <span class="keyword">with</span> list0_remove_at_exn</span>
<span class="dynexp"><span class="keyword">overload</span> takeout_at <span class="keyword">with</span> list0_takeout_at_exn</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_append
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> list0_append</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> append <span class="keyword">with</span> list0_append</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>append <span class="keyword">with</span> list0_append</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_extend
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> y0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> list0_snoc <span class="keyword">=</span> list0_extend</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> extend <span class="keyword">with</span> list0_extend</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>extend <span class="keyword">with</span> list0_extend</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
mul_int_list0
<span class="keyword">(</span>
  m0<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [mul_int_list0]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> reverse <span class="keyword">with</span> list0_reverse</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>reverse <span class="keyword">with</span> list0_reverse</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_reverse_append
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_reverse_append]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
list0_revapp <span class="keyword">=</span> list0_reverse_append</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> revapp <span class="keyword">with</span> list0_reverse_append</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>revapp <span class="keyword">with</span> list0_reverse_append</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_concat
  <span class="keyword">(</span>xss<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> concat <span class="keyword">with</span> list0_concat</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_take_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_take_exn]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_drop_exn]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_cata
<span class="keyword">(</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> f_nil<span class="keyword">:</span> <span class="staexp">cfun0</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> f_cons<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_cata]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_app
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_app]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_foreach
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_foreach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_foreach_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_foreach_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foreach <span class="keyword">with</span> list0_foreach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_rforeach
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_rforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_rforeach_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_rforeach_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>rforeach <span class="keyword">with</span> list0_rforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_iforeach
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span><span class="comment">(*length*)</span> <span class="comment">// end of [list0_iforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_iforeach_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span><span class="comment">(*length*)</span> <span class="comment">// end of [list0_iforeach_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>iforeach <span class="keyword">with</span> list0_iforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_foreach2
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_foreach2]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_foreach2_eq
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">,</span> sgn<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list0_foreach2_eq]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_foldleft
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_foldleft]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_foldleft_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_foldleft_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldleft <span class="keyword">with</span> list0_foldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_ifoldleft
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun3</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_ifoldleft]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_ifoldleft_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun3</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_ifoldleft_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>ifoldleft <span class="keyword">with</span> list0_ifoldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_foldleft2
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun3</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_foldleft2]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_foldright
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_foldright]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_foldright_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [list0_foldright_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldright <span class="keyword">with</span> list0_foldright_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{
a:t0p}{res:t0p
} list0_ifoldright
  (xs: list0(INV(a)), fopr: cfun3(int, a, res, res), snk: res): res
// end of [list0_ifoldright]
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_exists
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_exists_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>exists <span class="keyword">with</span> list0_exists_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_iexists
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_iexists]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_iexists_method
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_iexists_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>iexists <span class="keyword">with</span> list0_iexists_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_exists2
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_exists2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_exists2_eq
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">,</span> sgn<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_exists2_eq]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_forall
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_forall_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>forall <span class="keyword">with</span> list0_forall_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_iforall
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_iforall]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_iforall_method
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_iforall_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>iforall <span class="keyword">with</span> list0_iforall_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_forall2 <span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_forall2]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_forall2_eq
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">,</span> sgn<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_forall2_eq]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_equal
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> eqfn<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list0_equal]</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_compare
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> cmpfn<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_compare]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_find_exn
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_find_opt
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_find_exn_method
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_find_opt_method
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>find <span class="keyword">with</span> list0_find_exn_method</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>find_opt <span class="keyword">with</span> list0_find_opt_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_find_index
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_find_index]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_find_suffix
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_find_suffix]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_skip_while
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_skip_while]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_skip_until
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_skip_until]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_take_while
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_take_while]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_take_until
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_take_until]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">,</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_assoc_exn
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">@(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> eq<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">,</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_assoc_opt
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">@(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> eq<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Option_vt</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_filter
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_filter_method
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>pred<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>filter <span class="keyword">with</span> list0_filter_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_map
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_map]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_mapopt
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_mapopt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_map_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_mapopt_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>map <span class="keyword">with</span> list0_map_method</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>mapopt <span class="keyword">with</span> list0_mapopt_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_mapcons
<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> xss<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> list0_mapcons</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_mapjoin
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_mapjoin_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_mapjoin_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>mapjoin <span class="keyword">with</span> list0_mapjoin_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_imap
<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_imapopt
<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_imap_method
<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_imapopt_method
<span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>imap <span class="keyword">with</span> list0_imap_method</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>imapopt <span class="keyword">with</span> list0_imapopt_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>
a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_map2
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_map2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>
a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_imap2
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun3</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_imap2]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tabulate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_tabulate_opt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_zip
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span> <span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(*
fun{
x,y:t0p}{z:t0p
} list0_zipwith
  (list0(INV(x)), list0(INV(y)), fopr: cfun2(x, y, z)): list0(z)
*)</span>
<span class="dynexp"><span class="keyword">macdef</span>
list0_zipwith <span class="keyword">=</span> list0_map2</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_cross
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span> <span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> list0_cross <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>z<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_crosswith
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">z</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">z</span><span class="keyword">)</span></span> <span class="comment">// end of [list0_crosswith]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_choose2_foreach
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_choose2_foreach_method
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>choose2_foreach <span class="keyword">with</span> list0_choose2_foreach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_xprod2_foreach
<span class="keyword">(</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_xprod2_foreach_method
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list0_xprod2_iforeach
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="staexp">cfun4</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_xprod2_iforeach_method
<span class="keyword">(</span>
  <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">(</span>
  fwork<span class="keyword">:</span> <span class="staexp">cfun4</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>xprod2_foreach <span class="keyword">with</span> list0_xprod2_foreach_method</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>xprod2_iforeach <span class="keyword">with</span> list0_xprod2_iforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list0_elt
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
un_streamize_list0_elt
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list0_suffix
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list0_choose2
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list0_nchoose
  <span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun
{a:t0p}
streamize_list0_nchoose_rest
  (list0(INV(a)), intGte(0)):&lt;!wrt&gt; stream_vt(@(list0(a), list0(a)))
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list0_zip
<span class="keyword">(</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list0_cross
<span class="keyword">(</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_is_ordered
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span>  <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_mergesort
<span class="keyword">(</span><span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_mergesort]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list0_quicksort
<span class="keyword">(</span><span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_quicksort]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [list0.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2011-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: July, 2012 *)</span>
<span class="comment">(* Authoremail: gmmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="extcode"><span class="extcode">%{#
#include \
"libats/ML/CATS/array0.cats"
%}</span></span> <span class="comment">// end of [%{#]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: in [basis.sats]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
array0_vt0ype_type
  <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt@ype</span><span class="comment">(*invariant*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">array0 <span class="keyword">=</span> <span class="staexp">array0_vt0ype_type</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span> <span class="comment">// end of [#if(0)]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
typedef array0(a: vt@ype) = arrszref(a)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
sortdef t0p = t@ype
sortdef vt0p = viewt@ype
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_0<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_1<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_2<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_3<span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_4
  <span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_5
  <span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_tuple_6
  <span class="keyword">(</span>x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x5<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array0_tuple</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_0</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_1</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_2</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_3</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_4</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_5</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_tuple <span class="keyword">with</span> array0_tuple_6</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_of_arrszref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">arrszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
arrszref_of_array0
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">arrszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_make_arrpsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>psz<span class="keyword">:</span> <span class="staexp">arrpsz</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_make_arrayref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>Arf<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> array0 <span class="keyword">with</span> array0_make_arrpsz</span>
<span class="dynexp"><span class="keyword">overload</span> array0 <span class="keyword">with</span> array0_make_arrayref</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_get_ref
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_get_size
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_get_length
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
array0_get_refsize
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
A <span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span>
array0_make_elt</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_make_elt_int
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_make_elt_size
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_make_elt <span class="keyword">with</span> array0_make_elt_int</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_make_elt <span class="keyword">with</span> array0_make_elt_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_make_list
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_make_rlist
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_make_subarray
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> st<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> ln<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [array0_make_subarray]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_get_at_size
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
array0_get_at_gint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
array0_get_at_guint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array0_get_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_get_at <span class="keyword">with</span> array0_get_at_gint</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_get_at <span class="keyword">with</span> array0_get_at_guint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_set_at_size
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
array0_set_at_gint
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
array0_set_at_guint
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array0_set_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_set_at <span class="keyword">with</span> array0_set_at_gint</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_set_at <span class="keyword">with</span> array0_set_at_guint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_exch_at_size
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
array0_exch_at_gint
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
array0_exch_at_guint
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array0_exch_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_exch_at <span class="keyword">with</span> array0_exch_at_gint</span>
<span class="dynexp"><span class="keyword">overload</span>
array0_exch_at <span class="keyword">with</span> array0_exch_at_guint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_interchange
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [array0_interchange]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_subcirculate
<span class="keyword">(</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [array0_subcirculate]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
print_array0 <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
prerr_array0 <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun{}
fprint_array$sep (out: FILEref): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_array0
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_array0_sep
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_copy<span class="keyword">(</span><span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_append
  <span class="keyword">(</span><span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [array0_append]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> array0_append</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> append <span class="keyword">with</span> array0_append</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>append <span class="keyword">with</span> array0_append</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_map
<span class="keyword">(</span>
A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [array0_map]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_map_method
<span class="keyword">(</span>
A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [array0_map_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>map <span class="keyword">with</span> array0_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_tabulate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [array0_tabulate]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_tabulate_method_int
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
<span class="keyword">(</span>
  asz<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [array0_tabulate_method_int]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_tabulate_method_size
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [array0_tabulate_method_size]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>array0_tabulate <span class="keyword">with</span> array0_tabulate_method_int</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>array0_tabulate <span class="keyword">with</span> array0_tabulate_method_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX:
** Raising NotFoundExn
** if no satisfying element is found
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_find_exn
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">size_t</span></span> <span class="comment">// end of [array0_find_exn]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_find_opt
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_exists
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_exists]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_exists_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_exists_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>exists <span class="keyword">with</span> array0_exists_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_iexists
<span class="keyword">(</span> xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_iexists]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_iexists_method
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">(</span>pred<span class="keyword">:</span> <span class="keyword">(</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_iexists_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>iexists <span class="keyword">with</span> array0_iexists_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_forall
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_forall]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_forall_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">(</span>pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_forall_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>forall <span class="keyword">with</span> array0_forall_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_iforall
<span class="keyword">(</span> xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_iforall]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array0_iforall_method
<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">(</span>pred<span class="keyword">:</span> <span class="keyword">(</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [array0_iforall_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>iforall <span class="keyword">with</span> array0_iforall_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_foreach
<span class="keyword">(</span>
  A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array0_foreach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_foreach_method
<span class="keyword">(</span>A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [array0_foreach_methon]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>foreach <span class="keyword">with</span> array0_foreach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_iforeach
<span class="keyword">(</span>
  A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array0_iforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_iforeach_method
<span class="keyword">(</span>A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [array0_iforeach_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>iforeach <span class="keyword">with</span> array0_iforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_rforeach
<span class="keyword">(</span> A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array0_rforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_rforeach_method
<span class="keyword">(</span>A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [array0_rforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>rforeach <span class="keyword">with</span> array0_rforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array0_foldleft
<span class="keyword">(</span> A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [array0_foldleft]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array0_foldleft_method
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">(</span>
  ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [array0_foldleft_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>foldleft <span class="keyword">with</span> array0_foldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array0_ifoldleft
<span class="keyword">(</span> A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [array0_ifoldleft]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array0_ifoldleft_method
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">(</span>
  ini<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [array0_ifoldleft_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>ifoldleft <span class="keyword">with</span> array0_ifoldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: this one is tail-recursive!</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array0_foldright
<span class="keyword">(</span>
  A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [array0_foldright]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array0_foldright_method
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">(</span>
  fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [array0_foldright_method]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>foldright <span class="keyword">with</span> array0_foldright_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_array0_elt
  <span class="keyword">(</span>A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_is_ordered
<span class="keyword">(</span> A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array0_quicksort
<span class="keyword">(</span> A0<span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Overloading certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array0_get_at_gint</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array0_set_at_gint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array0_get_at_guint</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array0_set_at_guint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> size <span class="keyword">with</span> array0_get_size</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> array0_get_length</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>size <span class="keyword">with</span> array0_get_size</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>length <span class="keyword">with</span> array0_get_length</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_array0</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> print_array0</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_array0</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_array0_sep</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [array0.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: December, 2012 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> <span class="comment">// prefix for external</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// names</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: in [basis.sats]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
matrix0_vt0ype_type
  <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt@ype</span><span class="comment">(*invariant*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">matrix0 <span class="keyword">=</span> <span class="staexp">matrix0_vt0ype_type</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span> <span class="comment">// #if(0)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
typedef
matrix0(a: vt@ype) = mtrxszref(a)
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
//
// HX: already defined
//
sortdef
t0p = t@ype and vt0p = viewt@ype
//
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix0_of_mtrxszref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mtrxszref_of_matrix0
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span>
matrix0_make_elt</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_make_elt_int
  <span class="keyword">(</span>nrow<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> init<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrix0_make_elt]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_make_elt_size
  <span class="keyword">(</span>nrow<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> init<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrix0_make_elt]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> matrix0_make_elt <span class="keyword">with</span> matrix0_make_elt_int</span>
<span class="dynexp"><span class="keyword">overload</span> matrix0_make_elt <span class="keyword">with</span> matrix0_make_elt_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix0_get_ref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix0_get_nrow<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix0_get_ncol<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix0_get_refsize
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
M <span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">matrixref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_get_at_int
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_get_at_size
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrix0_get_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> matrix0_get_at <span class="keyword">with</span> matrix0_get_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> matrix0_get_at <span class="keyword">with</span> matrix0_get_at_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_set_at_int
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_set_at_size
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrix0_set_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> matrix0_set_at <span class="keyword">with</span> matrix0_set_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> matrix0_set_at <span class="keyword">with</span> matrix0_set_at_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
print_matrix0<span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
prerr_matrix0<span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
fprint_matrix$sep1 // col separation
fprint_matrix$sep2 // row separation
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrix0
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrix0_sep
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">string</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrix0_sep]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix0_copy<span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix0_tabulate
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrix0_tabulate]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix0_tabulate_method_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
<span class="keyword">(</span> nrow<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrix0_tabulate_method_int]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix0_tabulate_method_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrix0_tabulate_method_size]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>matrix0_tabulate <span class="keyword">with</span> matrix0_tabulate_method_int</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">.</span>matrix0_tabulate <span class="keyword">with</span> matrix0_tabulate_method_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix0_foreach
<span class="keyword">(</span>
M <span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix0_foreach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix0_iforeach
<span class="keyword">(</span>
M <span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix0_iforeach]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix0_foldleft
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [matrix0_foldleft]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix0_ifoldleft
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrix0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [matrix0_ifoldleft]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>nrow <span class="keyword">with</span> matrix0_get_nrow</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>ncol <span class="keyword">with</span> matrix0_get_ncol</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix0_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix0_set_at_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix0_get_at_size <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix0_set_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_matrix0</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> print_matrix0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_matrix0</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_matrix0_sep</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrix0.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2011-2016 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: October, 2016 *)</span>
<span class="comment">(* Authoremail: gmmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME
"ATSLIB.libats.ML"</span>
<span class="comment">//</span>
<span class="comment">// HX: prefix for external names</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream2list0
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_make_list0
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intgte_stream
  <span class="keyword">(</span>start<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_make_intrange_lr
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_make_intrange_lrd
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
intrange_stream <span class="keyword">with</span> stream_make_intrange_lr</span>
<span class="dynexp"><span class="keyword">overload</span>
intrange_stream <span class="keyword">with</span> stream_make_intrange_lrd</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_map_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>map <span class="keyword">with</span> stream_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_imap
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_imap_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>imap <span class="keyword">with</span> stream_imap_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_filter
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_filter_method
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">(</span>
  pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>filter <span class="keyword">with</span> stream_filter_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_scan
<span class="keyword">(</span>
  <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_scan_method
<span class="keyword">(</span>
  <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>scan <span class="keyword">with</span> stream_scan_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_foreach
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_foreach_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foreach <span class="keyword">with</span> stream_foreach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_iforeach
<span class="keyword">(</span> xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_iforeach_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">(</span>fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>iforeach <span class="keyword">with</span> stream_iforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_foldleft
  <span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_foldleft_method
  <span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldleft <span class="keyword">with</span> stream_foldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2011-2016 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: October, 2016 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
"libats/ML/SATS/basis.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream2list0_vt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_make_list0
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intgte_stream_vt
  <span class="keyword">(</span>start<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_vt_make_intrange_lr
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_vt_make_intrange_lrd
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
intrange_stream_vt
<span class="keyword">with</span>
stream_vt_make_intrange_lr</span>
<span class="dynexp"><span class="keyword">overload</span>
intrange_stream_vt
<span class="keyword">with</span>
stream_vt_make_intrange_lrd</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map_method
<span class="keyword">(</span>
  <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span>
<span class="keyword">(</span>
  <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>map <span class="keyword">with</span> stream_vt_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_filter_method
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span><span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>filter <span class="keyword">with</span> stream_vt_filter_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_foreach_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> 
<span class="keyword">:</span> <span class="keyword">(</span><span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_rforeach_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> 
<span class="keyword">:</span> <span class="keyword">(</span><span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foreach <span class="keyword">with</span> stream_vt_foreach_method</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>rforeach <span class="keyword">with</span> stream_vt_rforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_iforeach_method
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> 
<span class="keyword">:</span> <span class="keyword">(</span><span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>iforeach <span class="keyword">with</span> stream_vt_iforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_foldleft_method
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span> <span class="staexp">res</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_ifoldleft_method
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">res</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lincloptr1</span><span class="keyword">&gt;</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldleft <span class="keyword">with</span> stream_vt_foldleft_method</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>ifoldleft <span class="keyword">with</span> stream_vt_ifoldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream_vt.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: January, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="neuexp"><span class="keyword">#define</span> ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">charlst0 <span class="keyword">=</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">stringlst0 <span class="keyword">=</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun fileref_open_opt
  (path: NSH(string), fm: file_mode): option0 (FILEref)
// end of [fileref_open_opt]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_line_charlst<span class="keyword">(</span>filr<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">charlst0</span></span>
<span class="comment">//</span>
<span class="comment">(*
** HX: for handling files of "tiny" size
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_lines_charlstlst<span class="keyword">(</span>filr<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">charlst0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_line_string<span class="keyword">(</span>filr<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">string</span></span>
<span class="comment">//</span>
<span class="comment">(*
** HX: for handling files of "tiny" size
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_lines_stringlst<span class="keyword">(</span>filr<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stringlst0</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
filename_get_lines_stringlst_opt<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">stringlst0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileref_char
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileptr_char
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEptr1</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileref_line
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileptr_line
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEptr1</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
//
// HX: this one is in prelude/filebas
//
fun{}
fileref_get_word$isalpha(c0: charNZ): bool
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileref_word
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileptr_word
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEptr1</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_filename_char
  <span class="keyword">(</span>fname<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">streamopt_vt</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_filename_line
  <span class="keyword">(</span>fname<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">streamopt_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_filename_word
  <span class="keyword">(</span>fname<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">streamopt_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
dirname_get_fnamelst<span class="keyword">(</span>dirname<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_dirname_fname<span class="keyword">(</span>dirname<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [filebas.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2014 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: September, 2014 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-04:</span>
<span class="comment">// intrange(l, r) is for integers i satisfying l &lt;= i &lt; r</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_repeat_lazy
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">lazy</span><span class="keyword">(</span><span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_repeat_cloref
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun0</span><span class="keyword">(</span><span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_repeat_method
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun0</span><span class="keyword">(</span><span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> int_repeat_lazy</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> repeat <span class="keyword">with</span> int_repeat_lazy</span>
<span class="dynexp"><span class="keyword">overload</span> repeat <span class="keyword">with</span> int_repeat_cloref</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>repeat <span class="keyword">with</span> int_repeat_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_forall_cloref
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_forall_method
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload forall with int_forall_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>forall <span class="keyword">with</span> int_forall_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_foreach_cloref
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_foreach_method
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload foreach with int_foreach_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foreach <span class="keyword">with</span> int_foreach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_rforeach_cloref
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_rforeach_method
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload rforeach with int_rforeach_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>rforeach <span class="keyword">with</span> int_rforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
int_foldleft_cloref
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
int_foldleft_method
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload foldleft with int_foldleft_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldleft <span class="keyword">with</span> int_foldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
int_foldright_cloref
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
int_foldright_method
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload foldright with int_foldright_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldright <span class="keyword">with</span> int_foldright_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_forall_cloref
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_forall_method
  <span class="keyword">(</span>lr<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload forall with intrange_forall_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>forall <span class="keyword">with</span> intrange_forall_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_foreach_cloref
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_foreach_method
  <span class="keyword">(</span>lr<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload foreach with intrange_foreach_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foreach <span class="keyword">with</span> intrange_foreach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_rforeach_cloref
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_rforeach_method
  <span class="keyword">(</span>lr<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload rforeach with intrange_rforeach_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>rforeach <span class="keyword">with</span> intrange_rforeach_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foldleft_cloref
<span class="keyword">(</span>
 l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [intrange_foldleft_cloref]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foldleft_method
<span class="keyword">(</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload foldleft with intrange_foldleft_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldleft <span class="keyword">with</span> intrange_foldleft_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foldright_cloref
<span class="keyword">(</span>
 l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [intrange_foldright_cloref]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foldright_method
<span class="keyword">(</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload foldright with intrange_foldright_cloref
*)</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>foldright <span class="keyword">with</span> intrange_foldright_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_streamGte<span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>streamGte <span class="keyword">with</span> int_streamGte</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_streamGte_vt<span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>streamGte_vt <span class="keyword">with</span> int_streamGte_vt</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
int_list0_map_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
int_list0_map_method
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>list0_map <span class="keyword">with</span> int_list0_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
int_array0_map_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
int_array0_map_method
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>array0_map <span class="keyword">with</span> int_array0_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
int_stream_map_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
int_stream_map_method
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>stream_map <span class="keyword">with</span> int_stream_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
int_stream_vt_map_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
int_stream_vt_map_method
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">TYPE</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">(</span>f0<span class="keyword">:</span> <span class="staexp">cfun</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>stream_vt_map <span class="keyword">with</span> int_stream_vt_map_method</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int2_foreach_cloref
  <span class="keyword">(</span>n1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> n2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange2_foreach_cloref
  <span class="keyword">(</span>l1<span class="keyword">:</span><span class="staexp">int</span><span class="keyword">,</span> r1<span class="keyword">:</span><span class="staexp">int</span><span class="keyword">,</span> l2<span class="keyword">:</span><span class="staexp">int</span><span class="keyword">,</span> r2<span class="keyword">:</span><span class="staexp">int</span><span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span><span class="staexp">int</span><span class="keyword">,</span><span class="staexp">void</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [intrange.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: August, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for maps of elements of type (a)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
map_type
<span class="keyword">(</span>
  key<span class="keyword">:</span><span class="keyword">t@ype</span>
<span class="keyword">,</span> itm<span class="keyword">:</span><span class="keyword">t0ype+</span>
<span class="keyword">)</span> <span class="keyword">=</span> ptr</span><span class="comment">(*boxed*)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">map<span class="keyword">(</span><span class="staexp">key<span class="keyword">:</span>t0p</span>
   <span class="keyword">,</span>
   <span class="staexp">itm<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">map_type</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
compare_key_key<span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
funmap_nil
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
funmap_make_nil
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_size
  <span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> size <span class="keyword">with</span> funmap_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
funmap_is_nil
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
funmap_isnot_nil
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> funmap_is_nil</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> funmap_isnot_nil</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_search
<span class="keyword">(</span>
  map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> k0<span class="keyword">:</span> <span class="staexp">key</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span> <span class="comment">// end of [funmap_search]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_insert
<span class="keyword">(</span>
  <span class="staexp">&amp;</span><span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span> <span class="comment">// end of [funmap_insert]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_takeout
<span class="keyword">(</span>
  map<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> k0<span class="keyword">:</span> <span class="staexp">key</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span> <span class="comment">// end of [funmap_takeout]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_remove
  <span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> k0<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_funmap$sep
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// fprint("; ")</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_funmap$mapto
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// fprint("-&gt;")</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key
<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_funmap
<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_funmap</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_foreach
  <span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p
<span class="keyword">;</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
funmap_foreach_env
  <span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p
<span class="keyword">;</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
funmap_foreach$fwork
  <span class="keyword">(</span>key<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">,</span> itm<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">itm</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_foreach_cloref
<span class="keyword">(</span>
  map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_listize
  <span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span> <span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> funmap_streamize
  <span class="keyword">(</span>map<span class="keyword">:</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">map_modtype
<span class="keyword">(</span>
  <span class="staexp">key<span class="keyword">:</span> t0p</span><span class="keyword">,</span> <span class="staexp">itm<span class="keyword">:</span> t0p</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$rec</span><span class="keyword">{</span>
<span class="comment">//</span>
<span class="stalab">nil</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">-&lt;&gt;</span> <span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">)</span>
<span class="keyword">,</span>
<span class="stalab">size</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_size&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">is_nil</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;&gt;</span> <span class="staexp">bool</span>
<span class="keyword">,</span>
<span class="stalab">isnot_nil</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">map</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;&gt;</span> <span class="staexp">bool</span>
<span class="keyword">,</span>
<span class="stalab">search</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_search&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">insert</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_insert&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">remove</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_remove&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">takeout</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_takeout&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">listize</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_listize&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">streamize</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funmap_streamize&lt;key<span class="keyword">,</span>itm<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [set_modtype] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p
<span class="keyword">;</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funmap_make_module<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">map_modtype</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [funmap.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: August, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="neuexp"><span class="keyword">#define</span> ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-08:</span>
<span class="comment">// for sets of elements of type a</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
set_type
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">t@ype+</span>
<span class="keyword">)</span> <span class="keyword">=</span> ptr</span><span class="comment">(*boxed*)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">set<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">set_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
compare_elt_elt<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> funset_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> funset_make_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> funset_sing<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> funset_make_sing<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_make_list<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_funset
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> set<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_funset]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_funset$sep<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// fprint(", ")</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_funset</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
funset_is_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
funset_isnot_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_size<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_is_member<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_isnot_member<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_insert
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span><span class="comment">(*[x0] in [xs]*)</span>
<span class="comment">// end of [funset_insert]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_remove
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span><span class="comment">(*[x0] in [xs]*)</span>
<span class="comment">// end of [funset_remove]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_getmax_opt<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_getmin_opt<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_takeoutmax_opt<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_takeoutmin_opt<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_union<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_intersect<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_differ<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_symdiff<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_equal<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: set ordering induced by the ordering on elements</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_compare<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_is_subset<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_is_supset<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_foreach<span class="keyword">(</span>set<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
funset_foreach_env
  <span class="keyword">(</span>set<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [funset_foreach_env]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
funset_foreach$fwork<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_foreach_cloref
  <span class="keyword">(</span>set<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_listize<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
funset_streamize<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">set_modtype
<span class="keyword">(</span>
  <span class="staexp">elt<span class="keyword">:</span><span class="keyword">t@ype</span></span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$rec</span><span class="keyword">{</span>
<span class="comment">//</span>
<span class="stalab">nil</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">-&lt;&gt;</span> <span class="staexp">set</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span>
<span class="keyword">,</span>
<span class="stalab">sing</span> <span class="keyword">=</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_sing&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">make_list</span> <span class="keyword">=</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_make_list&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">size</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_size&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">is_nil</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">set</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;&gt;</span> <span class="staexp">bool</span>
<span class="keyword">,</span>
<span class="stalab">isnot_nil</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">set</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;&gt;</span> <span class="staexp">bool</span>
<span class="keyword">,</span>
<span class="stalab">insert</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_insert&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">remove</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_remove&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">union</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_union&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">intersect</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_intersect&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">listize</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_listize&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="keyword">,</span>
<span class="stalab">streamize</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>funset_streamize&lt;elt<span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [set_modtype] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span>
funset_make_module<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">set_modtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [funset.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: August, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.libats.ML"</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_EXTERN_PREFIX "atslib_ML_"</span> <span class="comment">// prefix for external names</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">hashtbl <span class="comment">// introduced in [basis.sats]</span>
<span class="keyword">(</span><span class="staexp">key<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">,</span> <span class="staexp">itm<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hash_key<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ulint</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> equal_key_key<span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_make_nil
  <span class="keyword">(</span>cap<span class="keyword">:</span> <span class="staexp">sizeGte</span><span class="keyword">(</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
hashtbl_get_size
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
hashtbl_get_capacity
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeGte</span><span class="keyword">(</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_search
  <span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">// end of [hashtbl_search]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_search_ref
  <span class="keyword">(</span>tbl<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> k<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">cPtr0</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">// end of [hashtbl_search_ref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_insert
  <span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">// end of [hashtbl_insert]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_insert_any
  <span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span><span class="comment">(*inserted*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_takeout
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> k0<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">// end of [hashtbl_takeout]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_remove
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_takeout_all
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [hashtbl_takeout_all]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span><span class="keyword">t@ype</span>
<span class="keyword">}</span></span> fprint_hashtbl
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> tbl<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_hashtbl</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_hashtbl$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// default: fprint("; ")</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_hashtbl$mapto <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// default: fprint("-&gt;")</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span><span class="keyword">t@ype</span>
<span class="keyword">}</span></span> fprint_hashtbl_sep_mapto
<span class="keyword">(</span> out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> tbl<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> mapto<span class="keyword">:</span> <span class="staexp">string</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_hashtbl_sep_mapto]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_foreach
  <span class="keyword">(</span>tbl<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p
<span class="keyword">;</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
hashtbl_foreach_env
  <span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p
<span class="keyword">;</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
hashtbl_foreach$fwork
  <span class="keyword">(</span>key<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">,</span> itm<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">itm</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_foreach_cloref
<span class="keyword">(</span>
  <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">itm</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [hashtbl_foreach_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_listize0
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> hashtbl_listize1
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [hashtblref.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: June, 2012 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span>
  
<span class="comment">(* ****** ****** *)</span>
  
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"
<span class="keyword">staload</span> "libats/ML/SATS/list0_vt.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_0<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_1<span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">=</span> g0ofg1<span class="keyword">(</span><span class="keyword">$list</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_2<span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">)</span> <span class="keyword">=</span> g0ofg1<span class="keyword">(</span><span class="keyword">$list</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_3<span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> g0ofg1<span class="keyword">(</span><span class="keyword">$list</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_4
<span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">)</span> <span class="keyword">=</span> g0ofg1<span class="keyword">(</span><span class="keyword">$list</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_5
<span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">)</span> <span class="keyword">=</span> g0ofg1<span class="keyword">(</span><span class="keyword">$list</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tuple_6
<span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">)</span> <span class="keyword">=</span> g0ofg1<span class="keyword">(</span><span class="keyword">$list</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_make_sing<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  list0_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> list0_nil<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_make_pair<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  list0_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> list0_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">,</span> list0_nil<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_make_elt
  <span class="keyword">(</span>n<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
n &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span>
    <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="dynexp"><span class="keyword">$raise</span> <span class="keyword">(</span>IllegalArgExn"list0_make_elt:n"<span class="keyword">)</span></span>
<span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
list0_make_intrange_lr
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> d <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">if</span> l &lt;= r <span class="keyword">then</span> <span class="dynexp">1</span> <span class="keyword">else</span> <span class="keyword">~</span><span class="dynexp">1</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span></span> <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_exn</span><span class="keyword">(</span>list0_make_intrange_lrd<span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_make_intrange_lr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
list0_make_intrange_lrd
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">res <span class="keyword">=</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop1 <span class="comment">// d &gt; 0</span>
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> l <span class="keyword">&lt;</span> r <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>
    res := list0_cons<span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span><span class="keyword">(</span>l<span class="keyword">,</span> _<span class="keyword">)</span>
  <span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list0_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop1 <span class="keyword">(</span>l+d<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span>res := list0_nil<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop1]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop2 <span class="comment">// d &lt; 0</span>
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> l <span class="keyword">&gt;</span> r <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>
    res := list0_cons<span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span><span class="keyword">(</span>l<span class="keyword">,</span> _<span class="keyword">)</span>
  <span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span> list0_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop2 <span class="keyword">(</span>l+d<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span>res := list0_nil<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop2]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_all</span>
<span class="keyword">(</span>
<span class="keyword">if</span> d <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">(</span>
  <span class="keyword">if</span> l <span class="keyword">&lt;</span> r <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span><span class="staexp">?</span> <span class="comment">// uninitialized</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop1 <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">,</span> res<span class="keyword">)</span></span> <span class="keyword">in</span> res
  <span class="keyword">end</span> <span class="keyword">else</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">if</span> d <span class="keyword">&lt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">(</span>
  <span class="keyword">if</span> l <span class="keyword">&gt;</span> r <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span><span class="staexp">?</span> <span class="comment">// uninitialized</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop2 <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">,</span> res<span class="keyword">)</span></span> <span class="keyword">in</span> res
  <span class="keyword">end</span> <span class="keyword">else</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
  <span class="dynexp"><span class="keyword">$raise</span>
  IllegalArgExn<span class="keyword">(</span>"list0_make_intrange_lrd:d"<span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="comment">(* end of [$effmask_all] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_make_intrange_lrd]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_make_arrpsz
  <span class="keyword">(</span>psz<span class="keyword">)</span> <span class="keyword">=</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>list_make_arrpsz<span class="keyword">(</span>psz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_make_arrpsz]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
print_list0
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>stdout_ref<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
prerr_list0
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_list0
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_list0_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  fprint_list_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [fprint_list0_sep] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_listlist0_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> xss<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  fprint_listlist_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
    <span class="keyword">(</span>out<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>List<span class="keyword">(</span>List<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xss<span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [fprint_listlist0_sep] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
//
// HX: these have been declared as macros:
//
implement
{a}(*tmp*)
list0_sing (x) = list0_cons{a}(x, list0_nil)
implement
{a}(*tmp*)
list0_pair (x1, x2) =
  list0_cons{a}(x1, list0_cons{a}(x2, list0_nil))
//
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_is_nil<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span> false <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [list0_is_nil] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_is_cons<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [list0_is_cons] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_is_empty<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> list0_is_nil&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_isnot_empty<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> list0_is_cons&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_head_exn
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="comment">// list0_cons</span>
<span class="keyword">|</span> list0_nil _ <span class="keyword">=&gt;</span>
    <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="comment">// list0_nil</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_head_exn]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_head_opt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> Some_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_head_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tail_exn
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="comment">// list0_cons</span>
<span class="keyword">|</span> list0_nil _ <span class="keyword">=&gt;</span>
    <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="comment">// list0_nil</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_tail_exn]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tail_opt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> Some_vt<span class="staexp"><span class="keyword">{</span>list0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_tail_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_last_exn
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0_list<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> list_last&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_last_exn]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_last_opt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0_list<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> Some_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>list_last<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_last_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_init_exn
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list_cons<span class="keyword">(</span>x0<span class="keyword">,</span> aux<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
      g0ofg1<span class="keyword">(</span>aux<span class="keyword">(</span>x<span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">)</span> <span class="comment">(* end of [list0_cons] *)</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_init_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_init_opt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list_cons<span class="keyword">(</span>x0<span class="keyword">,</span> aux<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  None_vt<span class="comment">(*void*)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  Some_vt<span class="keyword">(</span>g0ofg1<span class="keyword">(</span>aux<span class="keyword">(</span>x<span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_init_opt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_nth_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
      <span class="keyword">then</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">)</span> <span class="keyword">else</span> x
  <span class="keyword">)</span> <span class="comment">// end of [list0_cons]</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn</span><span class="comment">(*void*)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list0_nil] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i0 <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i0 &gt;= <span class="dynexp">0</span>
  <span class="keyword">then</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn</span><span class="comment">(*void*)</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_nth_exn]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_nth_opt
<span class="keyword">(</span>
  xs<span class="keyword">,</span> i0
<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_exn</span>
<span class="keyword">(</span>
<span class="dynexp"><span class="keyword">try</span>
Some_vt<span class="keyword">{</span>a<span class="keyword">}</span>
<span class="keyword">(</span>
  list0_nth_exn&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">with</span> <span class="keyword">~</span>ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt</span><span class="comment">(*void*)</span>
<span class="keyword">)</span></span> <span class="comment">(* $effmask_exn *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_get_at_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span> <span class="keyword">=</span> list0_nth_exn&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_get_at_opt
  <span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span> <span class="keyword">=</span> list0_nth_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_fset_at_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fset
<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
      <span class="keyword">then</span> cons0<span class="keyword">(</span>x<span class="keyword">,</span> fset<span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> cons0<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span> <span class="comment">// end of [list0_cons]</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [fset] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i0 <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>i0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i0 &gt;= <span class="dynexp">0</span>
  <span class="keyword">then</span> fset<span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_fset_at_exn]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_fset_at_opt
<span class="keyword">(</span>
  xs<span class="keyword">,</span> i0<span class="keyword">,</span> x0
<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_exn</span>
<span class="keyword">(</span>
<span class="dynexp"><span class="keyword">try</span>
Some_vt<span class="keyword">{</span>list0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span>
<span class="keyword">(</span>
  list0_fset_at_exn&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">with</span> <span class="keyword">~</span>ListSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">(* $effmask_exn *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_fexch_at_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fexch
<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> visited<span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x1<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span>
    <span class="keyword">(</span>i <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
    <span class="keyword">then</span>
    <span class="keyword">(</span>
      fexch
      <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> list_vt_cons<span class="keyword">(</span>x1<span class="keyword">,</span> visited<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">)</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> x2 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">,</span> x1<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> x2_xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>list0_cons<span class="keyword">(</span>x2<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
    <span class="keyword">in</span>
      g0ofg1<span class="keyword">(</span>list_reverse_append1_vt<span class="keyword">(</span>visited<span class="keyword">,</span> x2_xs<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [else]</span>
  <span class="keyword">)</span>  
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_free<span class="keyword">(</span>visited<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">end</span> <span class="comment">// end of [list0_nil]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i0 <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>i0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> i0 &gt;= <span class="dynexp">0</span>
    <span class="keyword">then</span> fexch<span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">,</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_fexch_at_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_fexch_at_opt
<span class="keyword">(</span>
  xs<span class="keyword">,</span> i0<span class="keyword">,</span> x0
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span>x0</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_exn</span>
<span class="keyword">(</span>
<span class="dynexp"><span class="keyword">try</span>
Some_vt<span class="keyword">{</span>list0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span>
<span class="keyword">(</span>
<span class="keyword">let</span>
  <span class="keyword">val</span>
  <span class="keyword">(</span>pf<span class="keyword">,</span> fpf <span class="keyword">|</span> p0<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr_vtake<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>p0<span class="keyword">)</span>
  <span class="keyword">val</span> res <span class="keyword">=</span>
  list0_fexch_at_exn&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i0<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="keyword">)</span>
<span class="keyword">with</span> <span class="keyword">~</span>ListSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="comment">(* $effmask_exn *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_fexch_at_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_insert_at_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span> <span class="staexp">a</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list0</span> <span class="staexp">a</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    list0_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> aux <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">)</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
  list0_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [aux]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> aux <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> IllegalArgExn<span class="keyword">(</span>"list0_insert_at_exn:i"<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_insert_at_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> auxlst <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">list0</span> <span class="staexp">a</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
      list0_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> auxlst&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x0 := x</span> <span class="keyword">in</span> xs
    <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list0_cons]</span>
<span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __assert <span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">end</span> <span class="comment">// end of [list0_nil]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [auxlst]</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_remove_at_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="staexp">?</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span>
  auxlst&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">else</span> <span class="keyword">(</span>
  <span class="dynexp"><span class="keyword">$raise</span>
  IllegalArgExn<span class="keyword">(</span>"list0_remove_at_exn:i"<span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_remove_at_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_takeout_at_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i &gt;= <span class="dynexp">0</span> <span class="keyword">then</span>
  auxlst&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __assert <span class="keyword">(</span>x0<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="dynexp"><span class="keyword">$raise</span> IllegalArgExn<span class="keyword">(</span>"list0_takeout_at_exn:i"<span class="keyword">)</span></span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_takeout_at_exn]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_length
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  list_length&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_append
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="keyword">and</span> ys <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
list0_of_list<span class="keyword">(</span>list_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_extend
  <span class="keyword">(</span>xs<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
list0_of_list_vt<span class="keyword">(</span>list_extend&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* $effmask_wrt *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_extend]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
mul_int_list0
  <span class="keyword">(</span>m<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
list0_of_list_vt
  <span class="keyword">(</span>mul_int_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>m<span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [mul_int_list0] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_reverse<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  list0_reverse_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> list0_nil<span class="keyword">)</span></span>
<span class="comment">// end of [list0_reverse]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_reverse_append
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="keyword">and</span> ys <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="keyword">in</span>
  list0_of_list<span class="keyword">(</span>list_reverse_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_reverse_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_concat
  <span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">xss <span class="keyword">=</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
list0_of_list_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span>
  <span class="keyword">(</span>list_concat&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>xss<span class="keyword">}</span></span><span class="keyword">(</span>xss<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* $effmask_wrt *)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_take_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0_list<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>i &gt;= <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
res <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_take_exn&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span>
  <span class="dynexp"><span class="keyword">$raise</span><span class="keyword">(</span>IllegalArgExn"list0_take_exn:i"<span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_take_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0_list <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>i &gt;= <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span>
g0ofg1<span class="keyword">(</span>list_drop_exn&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">else</span>
<span class="dynexp"><span class="keyword">$raise</span><span class="keyword">(</span>IllegalArgExn"list0_drop_exn:i"<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_drop_exn]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span><span class="comment">//tmp</span>
list0_cata
  <span class="keyword">(</span>xs<span class="keyword">,</span> fnil<span class="keyword">,</span> fcons<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> fnil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> fcons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_app
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> list0_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_foreach
<span class="keyword">(</span>
  xs<span class="keyword">,</span> fwork
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fwork<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [list0_cons]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_foreach] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_foreach_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_rforeach
<span class="keyword">(</span>
  xs<span class="keyword">,</span> fwork
<span class="keyword">)</span> <span class="keyword">=</span> aux0<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux0<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>aux0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">;</span> fwork<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_rforeach] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_rforeach_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_rforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_iforeach
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  i0<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> i0
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>fwork<span class="keyword">(</span>i0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>i0+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// end of [list0_cons]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_iforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_iforeach_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_foreach2
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> sgn<span class="keyword">:</span> <span class="staexp">int</span> <span class="comment">// uninitialized</span>
<span class="keyword">in</span>
  list0_foreach2_eq <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fwork<span class="keyword">,</span> sgn<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_foreach2]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_foreach2_eq
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fwork<span class="keyword">,</span> sgn
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> sgn<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
<span class="keyword">,</span> sgn<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs1 <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>sgn := <span class="dynexp">0</span><span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>sgn := <span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>sgn := <span class="dynexp">1</span><span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
        <span class="keyword">(</span>fwork<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> sgn<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_foreach2_eq] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
list0_foldleft
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">(</span>res<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_foldleft]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
list0_foldleft_method<span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span>list0_foldleft&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
list0_ifoldleft
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">,</span> fopr<span class="keyword">(</span>res<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_ifoldleft]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
list0_ifoldleft_method<span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    list0_ifoldleft&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span>
  <span class="comment">// end of [lam</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_foldleft2
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> ini<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs1 <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
      <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
      <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
      <span class="keyword">|</span> list0_cons <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
        <span class="keyword">(</span>
          loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fopr<span class="keyword">(</span>res<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">)</span> <span class="comment">(* end of [list0_cons] *)</span>
    <span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [list0_foldleft2] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span>
list0_foldright
<span class="keyword">(</span>
  xs<span class="keyword">,</span> fopr<span class="keyword">,</span> snk
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> snk
  <span class="keyword">|</span> list0_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> fopr<span class="keyword">(</span>x<span class="keyword">,</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_foldright] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span>
list0_foldright_method<span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_foldright&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_exists
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
<span class="keyword">|</span> list0_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> true <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="comment">// list0_cons</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_exists] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_exists_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_exists&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> p<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_iexists
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> pred<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">then</span> true <span class="keyword">else</span> loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span>
    <span class="comment">// list0_cons</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_iexists] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_iexists_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_iexists&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> p<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_exists2
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> p0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> sgn<span class="keyword">:</span> <span class="staexp">int</span> <span class="comment">// uninitized</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_exists2_eq&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> p0<span class="keyword">,</span> sgn<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_exists2]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_exists2_eq
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> pred<span class="keyword">,</span> sgn
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> sgn<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
<span class="keyword">,</span> sgn<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs1 <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>sgn := <span class="dynexp">0</span><span class="keyword">;</span> false<span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>sgn := <span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">;</span> false<span class="keyword">)</span>
    <span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons
      <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>sgn := <span class="dynexp">1</span><span class="keyword">;</span> false<span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons
        <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>
        <span class="keyword">if</span> pred<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
          <span class="keyword">then</span> <span class="keyword">(</span>sgn := <span class="dynexp">0</span><span class="keyword">;</span> true<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> sgn<span class="keyword">)</span>
        <span class="comment">// end of [if]</span>
      <span class="keyword">)</span> <span class="comment">(* end of [list0_cons] *)</span>
    <span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_exists2_eq] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_forall
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">else</span> false
    <span class="comment">// list0_cons</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_forall] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_forall_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_forall&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> p<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_iforall
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
  <span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> pred<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">else</span> false
    <span class="comment">// list0_cons</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_iforall] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_iforall_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_iforall&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> p<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_forall2
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> p0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> sgn<span class="keyword">:</span> <span class="staexp">int</span> <span class="comment">// uninitized</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_forall2_eq&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> p0<span class="keyword">,</span> sgn<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_forall2]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
list0_forall2_eq
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> pred<span class="keyword">,</span> sgn
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> sgn<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
<span class="keyword">,</span> sgn<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs1 <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>sgn := <span class="dynexp">0</span><span class="keyword">;</span> true<span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>sgn := <span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">;</span> true<span class="keyword">)</span>
    <span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons
      <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>sgn := <span class="dynexp">1</span><span class="keyword">;</span> true<span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons
        <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>
        <span class="keyword">if</span> pred<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
          <span class="keyword">then</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> sgn<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>sgn := <span class="dynexp">0</span><span class="keyword">;</span> false<span class="keyword">)</span>
        <span class="comment">// end of [if]</span>
      <span class="keyword">)</span> <span class="comment">(* end of [list0_cons] *)</span>
    <span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_forall2_eq] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_equal
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> eqfn
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs1 <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
    <span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span> false
    <span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons
      <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil
        <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
      <span class="comment">// list0_nil</span>
    <span class="keyword">|</span> list0_cons
        <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
        <span class="keyword">if</span> eqfn<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
          <span class="keyword">then</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">else</span> false
        <span class="comment">// end of [if]</span>
      <span class="comment">// end of [list0_cons]</span>
    <span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_equal] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_compare
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> cmpfn
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs1 <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp">0</span>
    <span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span> <span class="keyword">~</span><span class="dynexp">1</span>
    <span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons
      <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="keyword">|</span> list0_cons
        <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> sgn <span class="keyword">=</span> cmpfn<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> sgn != <span class="dynexp">0</span> <span class="keyword">then</span> sgn <span class="keyword">else</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list0_cons]</span>
    <span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_compare] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_find_exn
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="dynexp"><span class="keyword">$raise</span> NotFoundExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="comment">// list0_nil</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> x <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="comment">// list0_cons</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_find_exn] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_find_opt
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    None_vt<span class="comment">(*void*)</span>
  <span class="comment">// list0_nil</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span>
      <span class="keyword">then</span> Some_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span></span> <span class="comment">(* end of [list_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_find_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_find_exn_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_find_exn&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_find_opt_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_find_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_find_index
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span>
      <span class="keyword">then</span> <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> i+<span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span></span> <span class="comment">(* end of [list0_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_find_index] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_find_suffix
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list0_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">then</span> xs <span class="keyword">else</span> loop<span class="keyword">(</span>xs2<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_find_suffix] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_skip_while
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list0_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">then</span> auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span> <span class="keyword">else</span> xs
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list0_skip_while]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_skip_until
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  list0_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">then</span> xs <span class="keyword">else</span> auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list0_skip_until]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_take_while
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>x0<span class="keyword">)</span>
    <span class="keyword">then</span> auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> list_vt_cons<span class="keyword">(</span>x0<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> res
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
list0_vt2t
<span class="keyword">(</span>g0ofg1<span class="keyword">(</span>list_vt_reverse<span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_take_while]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_take_until
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>x0<span class="keyword">)</span>
    <span class="keyword">then</span> res <span class="keyword">else</span> auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> list_vt_cons<span class="keyword">(</span>x0<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
list0_vt2t
<span class="keyword">(</span>g0ofg1<span class="keyword">(</span>list_vt_reverse<span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_take_until]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_assoc_exn
<span class="keyword">(</span>
  xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span> <span class="keyword">(</span>
list0_assoc_exn&lt;a<span class="keyword">,</span>b<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xys <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> NotFoundExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>xy<span class="keyword">,</span> xys<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> eq <span class="keyword">(</span>x0<span class="keyword">,</span> xy<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span> <span class="keyword">then</span> xy<span class="dynexp"><span class="keyword">.1</span></span> <span class="keyword">else</span> loop<span class="keyword">(</span>xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq<span class="keyword">)</span></span>
  <span class="comment">// end of [list0_cons]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_assoc_exn] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_assoc_opt
<span class="keyword">(</span>
  xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>
list0_assoc_opt&lt;a<span class="keyword">,</span>b<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xys <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    None_vt<span class="comment">(*void*)</span>
  <span class="comment">// list0_nil</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>xy<span class="keyword">,</span> xys<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> eq <span class="keyword">(</span>x0<span class="keyword">,</span> xy<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span>
      <span class="keyword">then</span> Some_vt<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span>xy<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xys<span class="keyword">,</span> x0<span class="keyword">,</span> eq<span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span></span> <span class="comment">(* end of [list_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_assoc_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_filter
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
list_filter$pred
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> pred<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> list_filter&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt <span class="keyword">(</span>ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_filter]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_filter_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_filter&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
implement
{a}{b}
list0_map
  (xs, fopr) = let
  viewdef v = unit_v
  viewtypedef fun_vt = cfun (a, b)
  fun app .&lt;&gt;.
    (pfu: !unit_v | x: a, fopr: !fun_vt): b = fopr (x)
  // end of [fun]
  prval pfu = unit_v ()
  var
  fopr = fopr
  val ys =
  list_map_funenv&lt;a&gt;&lt;b&gt; {v}{vt} (pfu | g1ofg0(xs), app, fopr)
  prval () = topize(fopr)
  prval unit_v((*void*)) = pfu
in
  list0_of_list_vt (ys)
end // end of [list0_map]
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_map<span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
list_map$fopr<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> list_map&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0_list<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span>ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_map]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_mapopt
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list0_nil] *)</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
  <span class="keyword">case+</span> fopr<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>y<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="keyword">(</span>
      res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="keyword">)</span>
      <span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>
      list_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*folded*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span><span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [Some0]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list0_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list0_of_list_vt <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list0_mapopt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_map_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_map&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_mapopt_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_mapopt&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_mapcons
  <span class="keyword">(</span>x0<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_map$fopr&lt;<span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;&lt;</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xss <span class="keyword">=</span> g1ofg0 <span class="keyword">(</span>xss<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_map&lt;<span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;&lt;</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xss<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_mapcons]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_mapjoin
<span class="keyword">(</span> xs
<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span>
  list0_concat&lt;<span class="staexp">b</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>list0_map&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_mapjoin_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_mapjoin&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_imap
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
list_imap$fopr<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_imap$fopr]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> list_imap&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0_list<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span>ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_imap]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_imapopt
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  i0<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list0_nil] *)</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
  <span class="keyword">case+</span>
  fopr<span class="keyword">(</span>i0<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>y<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="keyword">(</span>
      res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="keyword">)</span>
      <span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>
      list_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>i0+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*folded*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span><span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [Some0]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>i0+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list0_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list0_of_list_vt<span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list0_imapopt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_imap_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="comment">(*TYPE*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_imap&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_imapopt_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="comment">(*TYPE*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_imapopt&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
implement
{a1,a2}{b}
list0_map2
  (xs1, xs2, fopr) = let
  viewdef v0 = unit_v
  viewtypedef fun_vt = cfun2 (a1, a2, b)
  val xs1 = g1ofg0_list(xs1)
  val xs2 = g1ofg0_list(xs2)
  fun app .&lt;&gt;.
    (pfu: !v0 | x1: a1, x2: a2, f: !fun_vt): b = fopr(x1, x2)
  // end of [fun]
  prval pfu = unit_v ()
  var
  fopr = fopr
  val ys =
  list_map2_funenv&lt;a1,a2&gt;&lt;b&gt; {v0}{vt} (pfu | xs1, xs2, app, fopr)
  prval () = topize(fopr)
  prval unit_v((*void*)) = pfu
in
  list0_of_list_vt (ys)
end // end of [list0_map2]
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_map2
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a11<span class="keyword">,</span>a12</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
list_map2$fopr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span>
  <span class="keyword">(</span>fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span>list_map2&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_map2]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list0_imap2
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> _n_<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="dynexp">0</span>
<span class="dynexp"><span class="keyword">val</span> nptr <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>_n_<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a11<span class="keyword">,</span>a12</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
list_map2$fopr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n0 <span class="keyword">=</span>
$UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">int</span><span class="keyword">&gt;</span><span class="keyword">(</span>nptr<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span>
  <span class="keyword">(</span>fopr<span class="keyword">(</span>n0<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">int</span><span class="keyword">&gt;</span><span class="keyword">(</span>nptr<span class="keyword">,</span> n0+<span class="dynexp">1</span><span class="keyword">)</span><span class="keyword">;</span> res
<span class="keyword">end</span></span> <span class="comment">// end of [list_map2$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span>list_map2&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>xs2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_imap2]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tabulate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>n<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
list_tabulate$fopr
  <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>natLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// list_tabulate$fopr</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n &gt;= <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span>
list0_of_list_vt<span class="keyword">(</span>list_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">else</span>
<span class="dynexp"><span class="keyword">$raise</span> IllegalArgExn<span class="keyword">(</span>"list0_tabulate:n"<span class="keyword">)</span></span>
<span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_tabulate_opt
  <span class="keyword">(</span>n<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">Nat</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> i<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="keyword">case+</span> fopr<span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="comment">// end of [None_vt]</span>
<span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">//</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">(</span>
      res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span>
    <span class="keyword">)</span></span> <span class="comment">(* end of [val] *)</span>
<span class="comment">//</span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
<span class="comment">//</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
<span class="comment">//</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*folded*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [Some0]</span>
<span class="keyword">)</span> <span class="keyword">else</span>
<span class="keyword">(</span>
  res := list_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list0_of_list_vt <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list0_tabulate_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span>
list0_zip
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="keyword">and</span> ys <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> xys <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_zip&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>x<span class="keyword">,</span>y<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_zip]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span>
list0_cross
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="keyword">and</span> ys <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> xys <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_cross&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>x<span class="keyword">,</span>y<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_cross]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">z</span><span class="keyword">}</span>
list0_crosswith
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2<span class="keyword">,</span>y2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">z2</span><span class="keyword">}</span>
list_crosswith$fopr<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>z2<span class="keyword">}</span></span>
  <span class="keyword">(</span>fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>y<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">and</span> ys <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> zs <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_crosswith&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">z</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>z<span class="keyword">}</span></span><span class="keyword">(</span>zs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_crosswith]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_choose2_foreach
<span class="keyword">(</span>
  xs<span class="keyword">,</span> fwork
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop2<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">,</span> xs<span class="keyword">)</span>
  <span class="comment">// end of [list0_cons]</span>
<span class="keyword">)</span>
<span class="keyword">and</span>
loop2
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> ys <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>x0<span class="keyword">,</span> y<span class="keyword">)</span></span> <span class="keyword">in</span> loop2<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">,</span> ys<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_choose2_foreach] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_choose2_foreach_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_choose2_foreach&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_xprod2_foreach
<span class="keyword">(</span>
  xs0<span class="keyword">,</span> ys0<span class="keyword">,</span> fwork
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs0<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop2<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">,</span> ys0<span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">and</span>
loop2
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> ys <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fwork<span class="keyword">(</span>x0<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">;</span> loop2<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_xprod2_foreach] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_xprod2_foreach_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_xprod2_foreach&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_xprod2_iforeach
<span class="keyword">(</span>
  xs0<span class="keyword">,</span> ys0<span class="keyword">,</span> fwork
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs0<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">int <span class="keyword">=</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span>
loop
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop2<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">,</span> ys0<span class="keyword">)</span>
  <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span>
<span class="keyword">and</span>
loop2
<span class="keyword">(</span>
i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">x</span>
<span class="keyword">,</span>
xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> ys <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>i0+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>fwork<span class="keyword">(</span>i0<span class="keyword">,</span> x0<span class="keyword">,</span> j<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">;</span> loop2<span class="keyword">(</span>i0<span class="keyword">,</span> x0<span class="keyword">,</span> xs<span class="keyword">,</span> j+<span class="dynexp">1</span><span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [list0_cons]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list0_xprod2_iforeach] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_xprod2_iforeach_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_xprod2_iforeach&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* list0_xprod2_iforeach_method *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list0_elt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  streamize_list_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
un_streamize_list0_elt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
list0_of_list_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>stream2list_vt<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list0_suffix
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
streamize_list0_suffix&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_vt_cons<span class="keyword">(</span>xs<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [streamize_list0_suffix] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list0_choose2
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> streamize_list_choose2&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list0_nchoose
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>  
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> 0<span class="keyword">)</span>
<span class="keyword">then</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> res1 <span class="keyword">=</span>
      auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> n-1<span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
    <span class="keyword">val</span> res2 <span class="keyword">=</span> auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> n<span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">!</span><span class="keyword">(</span>stream_vt_append
      <span class="keyword">(</span>
        stream_vt_map_cloptr&lt;list0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">&gt;&lt;</span>list0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">&gt;</span><span class="keyword">(</span>res1<span class="keyword">,</span> <span class="keyword">lam</span><span class="keyword">(</span>ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_cons<span class="keyword">(</span>x0<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> res2
      <span class="keyword">)</span> <span class="comment">// stream_vt_append</span>
     <span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list0_cons]</span>
<span class="keyword">)</span> <span class="comment">(* end of [then] *)</span>
<span class="keyword">else</span>
<span class="keyword">(</span>
  stream_vt_cons<span class="keyword">(</span>list0_nil<span class="keyword">,</span> stream_vt_make_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>list0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span></span></span> <span class="comment">// auxmain</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_list0_nchoose]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list0_zip
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span>
  streamize_list_zip&lt;<span class="staexp">a</span><span class="keyword">,</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list0_cross
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span>
  streamize_list_cross&lt;<span class="staexp">a</span><span class="keyword">,</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>ys<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_is_ordered
  <span class="keyword">(</span>xs<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> cmp<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_is_ordered&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0_list<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_is_ordered]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_mergesort<span class="keyword">(</span>xs<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_mergesort$cmp&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> cmp<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_mergesort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt <span class="keyword">(</span>ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_mergesort]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list0_quicksort<span class="keyword">(</span>xs<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_quicksort$cmp&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> cmp<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_quicksort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list0_of_list_vt <span class="keyword">(</span>ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list0_quicksort]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: some common generic functions</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
fprint_val&lt;<span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_list0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
gcompare_val_val&lt;<span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxlst
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> ys <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp">0</span>
    <span class="keyword">|</span> list0_cons _ <span class="keyword">=&gt;</span> <span class="keyword">~</span><span class="dynexp">1</span>
  <span class="keyword">)</span> <span class="comment">(* list0_nil *)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> ys <span class="keyword">of</span>
    <span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp">1</span>
    <span class="keyword">|</span> list0_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> sgn <span class="keyword">=</span>
          gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
        <span class="comment">// end of [val]</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> sgn != <span class="dynexp">0</span> <span class="keyword">then</span> sgn <span class="keyword">else</span> auxlst<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list0_cons]</span>
  <span class="keyword">)</span> <span class="comment">(* list0_cons *)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [auxlst] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxlst<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [gcompare_val_val] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [list0.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: July, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"
<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"
<span class="keyword">staload</span> "libats/ML/SATS/array0.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span>
memcpy
<span class="keyword">(</span>
  d<span class="keyword">:</span><span class="staexp">ptr</span><span class="keyword">,</span> s<span class="keyword">:</span><span class="staexp">ptr</span><span class="keyword">,</span> n<span class="keyword">:</span><span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#atslib_ML_array0_memcpy"</span>
<span class="comment">// end of [memcpy]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_0
  <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_1
  <span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">=</span> array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_2
  <span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">)</span> <span class="keyword">=</span> array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_3
  <span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_4
  <span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">)</span> <span class="keyword">=</span>
  array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_5
  <span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">)</span> <span class="keyword">=</span>
  array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tuple_6
  <span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">)</span> <span class="keyword">=</span>
  array0<span class="keyword">(</span><span class="keyword">$arrpsz</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_of_arrszref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>array0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrszref_of_array0
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrszref<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_get_ref
  <span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span>
arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span> <span class="keyword">in</span> arrszref_get_ref<span class="keyword">(</span>ASZ<span class="keyword">)</span>
<span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_get_ref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_get_size
  <span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span>
arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span> <span class="keyword">in</span> arrszref_get_size<span class="keyword">(</span>ASZ<span class="keyword">)</span>
<span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_get_size]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_get_length
  <span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span> sz2i<span class="keyword">(</span>g1ofg0_uint<span class="keyword">(</span>array0_get_size&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_get_refsize
  <span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">@(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_get_refsize]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_make_arrpsz
  <span class="keyword">(</span>psz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span>
arrszref_make_arrpsz<span class="keyword">(</span>psz<span class="keyword">)</span></span> <span class="keyword">in</span> array0_of_arrszref<span class="keyword">(</span>ASZ<span class="keyword">)</span>
<span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_make_arrpsz]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array0_make_arrayref
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span>
arrszref_make_arrayref<span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span></span> <span class="keyword">in</span> array0_of_arrszref<span class="keyword">(</span>ASZ<span class="keyword">)</span>
<span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_make_arrpsz]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_make_elt_int
  <span class="keyword">(</span>asz<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> asz <span class="keyword">=</span> i2sz<span class="keyword">(</span>max<span class="keyword">(</span>g1ofg0<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
array0_of_arrszref<span class="keyword">(</span>arrszref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>asz<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_make_elt_int]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_make_elt_size
  <span class="keyword">(</span>asz<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
array0_of_arrszref<span class="keyword">(</span>arrszref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>asz<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [array0_make_elt_size] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_make_list
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="keyword">in</span>
  array0_of_arrszref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>arrszref_make_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_make_list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_make_rlist
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="keyword">in</span>
  array0_of_arrszref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>arrszref_make_rlist&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_make_subarray
  <span class="keyword">(</span>A0<span class="keyword">,</span> st<span class="keyword">,</span> ln<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> st <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>st<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> ln <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>ln<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">]</span>
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> array0_get_refsize<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">st<span class="keyword">:</span>int</span><span class="keyword">]</span> st <span class="keyword">=</span>
  <span class="keyword">(</span><span class="keyword">if</span> st &lt;= asz <span class="keyword">then</span> st <span class="keyword">else</span> asz<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">ln<span class="keyword">:</span>int</span><span class="keyword">]</span> ln <span class="keyword">=</span>
  <span class="keyword">(</span><span class="keyword">if</span> st + ln &lt;= asz <span class="keyword">then</span> ln <span class="keyword">else</span> asz - st<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">st</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A2 <span class="keyword">=</span> arrayptr_make_uninitized&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>ln<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> memcpy <span class="keyword">(</span>ptrcast<span class="keyword">(</span>A2<span class="keyword">)</span><span class="keyword">,</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>ptrcast<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> st<span class="keyword">)</span><span class="keyword">,</span> ln*sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A2 <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>a<span class="keyword">,</span>ln<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>A2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  array0_make_arrayref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>A2<span class="keyword">,</span> ln<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_make_subarray]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
print_array0<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_array0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>stdout_ref<span class="keyword">,</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
prerr_array0<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_array0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>stderr_ref<span class="keyword">,</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_array0<span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">)</span> <span class="keyword">=</span>
fprint_arrszref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> arrszref_of_array0<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_array0_sep <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span>
fprint_arrszref_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> arrszref_of_array0<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
array0_get_at_gint
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i &gt;= <span class="dynexp">0</span> <span class="keyword">then</span>
  array0_get_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> g0i2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span> <span class="comment">// neg index</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_get_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
array0_get_at_guint
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  array0_get_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> g0u2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_get_at_guint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_get_at_size
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  arrszref_get_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [array0_get_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
array0_set_at_gint
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> i &gt;= <span class="dynexp">0</span> <span class="keyword">then</span>
  array0_set_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> g0i2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span> <span class="comment">// neg index</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">// end of [array0_set_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
array0_set_at_guint
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  array0_set_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> g0u2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [array0_set_at_guint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_set_at_size
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  arrszref_set_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [array0_set_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
array0_exch_at_gint
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i &gt;= <span class="dynexp">0</span> <span class="keyword">then</span>
  array0_exch_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> g0i2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span> <span class="comment">// neg index</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_exch_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
array0_exch_at_guint
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  array0_exch_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> g0u2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [array0_exch_at_guint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_exch_at_size
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  arrszref_exch_at_size<span class="keyword">(</span>arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [array0_exch_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_interchange
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ASZ <span class="keyword">=</span>
    arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span> <span class="keyword">in</span> arrszref_interchange<span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
  <span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_subcirculate
  <span class="keyword">(</span>A0<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ASZ <span class="keyword">=</span>
    arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span> <span class="keyword">in</span> arrszref_subcirculate<span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
  <span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_copy
  <span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span>
arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfarr</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> q<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>q<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A2 <span class="keyword">=</span> arrayptr_encode<span class="keyword">(</span><span class="prfexp">pfarr</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> q<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A2 <span class="keyword">=</span> arrayptr_refize<span class="keyword">(</span>A2<span class="keyword">)</span></span> <span class="comment">// non-linearizing</span>
<span class="dynexp"><span class="keyword">val</span> ASZ2 <span class="keyword">=</span> arrszref_make_arrayref<span class="keyword">(</span>A2<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  array0_of_arrszref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>ASZ2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_append
  <span class="keyword">(</span>A01<span class="keyword">,</span> A02<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ASZ1 <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A01<span class="keyword">)</span>
<span class="keyword">and</span> ASZ2 <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A02<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> asz1<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">and</span> asz2<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A1 <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ1<span class="keyword">,</span> asz1<span class="keyword">)</span>
<span class="keyword">and</span> A2 <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ2<span class="keyword">,</span> asz2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf1box</span> <span class="keyword">|</span> p1<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr<span class="keyword">(</span>A1<span class="keyword">)</span>
<span class="keyword">and</span> <span class="keyword">(</span><span class="prfexp">pf2box</span> <span class="keyword">|</span> p2<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr<span class="keyword">(</span>A2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span>
unbox<span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span> <span class="keyword">:</span>
<span class="staexp">vbox</span><span class="keyword">(</span><span class="staexp">v</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">v</span><span class="keyword">,</span> <span class="staexp">v</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">(</span>pf1<span class="keyword">,</span> fpf1<span class="keyword">)</span> <span class="keyword">=</span> unbox<span class="keyword">(</span>pf1box<span class="keyword">)</span> <span class="keyword">and</span> <span class="keyword">(</span>pf2<span class="keyword">,</span> fpf2<span class="keyword">)</span> <span class="keyword">=</span> unbox<span class="keyword">(</span>pf2box<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> asz <span class="keyword">=</span> asz1 + asz2</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span><span class="prfexp">pfarr</span><span class="keyword">,</span><span class="prfexp">pfgc</span><span class="keyword">|</span>q<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">(</span>pf1arr<span class="keyword">,</span>
 pf2arr<span class="keyword">)</span> <span class="keyword">=</span> array_v_split_at<span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> asz1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>q<span class="keyword">,</span> <span class="keyword">!</span>p1<span class="keyword">,</span> asz1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> q2 <span class="keyword">=</span> ptr1_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>q<span class="keyword">,</span> asz1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf2arr</span> <span class="keyword">|</span> q2<span class="keyword">)</span> <span class="keyword">=</span> viewptr_match<span class="keyword">(</span><span class="prfexp">pf2arr</span> <span class="keyword">|</span> q2<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>q2<span class="keyword">,</span> <span class="keyword">!</span>p2<span class="keyword">,</span> asz2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf1<span class="keyword">(</span>pf1<span class="keyword">)</span> <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf2<span class="keyword">(</span>pf2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
pfarr <span class="keyword">=</span> array_v_unsplit<span class="keyword">(</span>pf1arr<span class="keyword">,</span> pf2arr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A12 <span class="keyword">=</span> arrayptr_encode<span class="keyword">(</span><span class="prfexp">pfarr</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> q<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A12 <span class="keyword">=</span> arrayptr_refize<span class="keyword">(</span>A12<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> ASZ12 <span class="keyword">=</span> arrszref_make_arrayref<span class="keyword">(</span>A12<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  array0_of_arrszref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>ASZ12<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_append]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
array0_map
  <span class="keyword">(</span>A<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> array0_get_ref<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> asz <span class="keyword">=</span> array0_get_size<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> fopr <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cfun1<span class="keyword">(</span>ptr<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
array0_tabulate&lt;<span class="staexp">b</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>g1ofg0<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">lam</span> i <span class="keyword">=&gt;</span> fopr<span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_map]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
array0_map_method
  <span class="keyword">(</span>A0<span class="keyword">,</span> _<span class="comment">(*TYPE*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_map&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tabulate
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>asz<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
array_tabulate$fopr
  <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// array_tabulate$fopr</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
array0_of_arrszref<span class="keyword">(</span>arrszref_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tabulate_method_int
  <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
array0_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i2sz<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">lam</span><span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> fopr<span class="keyword">(</span>sz2i<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_tabulate_method_size
  <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>asz<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_find_exn
  <span class="keyword">(</span>A0<span class="keyword">,</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">~</span>p<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*nothing*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> idx <span class="keyword">=</span> arrayref_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> idx <span class="keyword">&lt;</span> asz <span class="keyword">then</span> idx <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> NotFoundExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_find_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
/*
implement
{a}(*tmp*)
array0_find_opt (A0, p) =
  try Some_vt(array0_find_exn&lt;a&gt; (A0, p)) with ~NotFoundExn() =&gt; None_vt()
// end of [array0_find_opt]
*/
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_exists
  <span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> not<span class="keyword">(</span>env<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> env := true <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
env <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span><span class="staexp">bool</span> <span class="keyword">=</span> false
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
  arrayref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span> <span class="comment">(* end of [where] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_exists]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_exists_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_exists&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_iexists
  <span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_iforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> not<span class="keyword">(</span>env<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
array_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">then</span> env := true <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
env <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span><span class="staexp">bool</span> <span class="keyword">=</span> false
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
  arrayref_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span> <span class="comment">(* end of [where] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_iexists]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_iexists_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_iexists&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_forall
  <span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>env<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> env := false</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
env <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span><span class="staexp">bool</span> <span class="keyword">=</span> true
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
  arrayref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span> <span class="comment">(* end of [where] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_forall]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_forall_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_forall&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_iforall
  <span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_iforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>env<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
array_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> pred<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> env := false</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
env <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span><span class="staexp">bool</span> <span class="keyword">=</span> true
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
  arrayref_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">bool</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span> <span class="comment">(* end of [where] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_iforall]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_iforall_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_iforall&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_foreach
  <span class="keyword">(</span>A0<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span> arrayref_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array0_foreach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_foreach_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_iforeach
  <span class="keyword">(</span>A0<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_iforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span> arrayref_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array0_iforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_iforeach_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_rforeach
  <span class="keyword">(</span>A0<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_rforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span>
array_rforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span> arrayref_rforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array0_rforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_rforeach_method<span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_rforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tres</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array0_foldleft
<span class="keyword">(</span>
  A0<span class="keyword">,</span> ini<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> env := fopr<span class="keyword">(</span>env<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
res<span class="keyword">:</span> <span class="staexp">tres</span> <span class="keyword">=</span> ini
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
  arrayref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [array0_foldleft] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tres</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array0_foldleft_method<span class="keyword">(</span>A0<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_foldleft&lt;<span class="staexp">tres</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tres</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array0_ifoldleft
<span class="keyword">(</span>
  A0<span class="keyword">,</span> ini<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_iforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
array_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>env := fopr<span class="keyword">(</span>env<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
res<span class="keyword">:</span> <span class="staexp">tres</span> <span class="keyword">=</span> ini
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
  arrayref_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [array0_ifoldleft] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tres</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array0_ifoldleft_method<span class="keyword">(</span>A0<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> array0_ifoldleft&lt;<span class="staexp">tres</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tres</span><span class="keyword">}</span>
array0_foldright
<span class="keyword">(</span>
  A0<span class="keyword">,</span> fopr<span class="keyword">,</span> snk
<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_rforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
array_rforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> env := fopr<span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
res<span class="keyword">:</span> <span class="staexp">tres</span> <span class="keyword">=</span> snk
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*asz*)</span> <span class="keyword">=</span>
arrayref_rforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [array0_foldright] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tres</span><span class="keyword">}</span>
array0_foldright_method
  <span class="keyword">(</span>A0<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    array0_foldright&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tres</span><span class="keyword">&gt;</span><span class="keyword">(</span>A0<span class="keyword">,</span> fopr<span class="keyword">,</span> snk<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [lam] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_is_ordered
  <span class="keyword">(</span>A0<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
gcompare_ref_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>cmp<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in-of-let *)</span>
<span class="comment">//</span>
<span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
  arrayref_is_ordered&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_is_ordered]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array0_quicksort
  <span class="keyword">(</span>A0<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
ASZ <span class="keyword">=</span> arrszref_of_array0<span class="keyword">(</span>A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
asz <span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize<span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_quicksort$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
cmp <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;a<span class="keyword">,</span>&amp;a<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span>int<span class="keyword">}</span></span><span class="keyword">(</span>cmp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
   cmp<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_quicksort$cmp]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayref_quicksort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array0_quicksort]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: some common generic functions</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
fprint_val&lt;<span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_array0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
gcompare_val_val&lt;<span class="staexp">array0</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> m <span class="keyword">=</span> array0_get_size<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> array0_get_size<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  px<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> py<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span> <span class="keyword">(</span>
i <span class="keyword">&lt;</span> m
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> j <span class="keyword">&lt;</span> n
  <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfx</span><span class="keyword">,</span> <span class="prfexp">fpfx</span> <span class="keyword">|</span> px<span class="keyword">)</span> <span class="keyword">=</span>
      $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>px<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfy</span><span class="keyword">,</span> <span class="prfexp">fpfy</span> <span class="keyword">|</span> py<span class="keyword">)</span> <span class="keyword">=</span>
      $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>py<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> sgn <span class="keyword">=</span> gcompare_ref_ref<span class="keyword">(</span><span class="keyword">!</span>px<span class="keyword">,</span> <span class="keyword">!</span>py<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfx<span class="keyword">(</span>pfx<span class="keyword">)</span> <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfy<span class="keyword">(</span>pfy<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> sgn != <span class="dynexp">0</span>
      <span class="keyword">then</span> <span class="keyword">(</span>sgn<span class="keyword">)</span>
      <span class="keyword">else</span> loop<span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>px<span class="keyword">)</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>py<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> j <span class="keyword">&lt;</span> n <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>array0_get_ref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">,</span> array0_get_ref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gcompare_val_val]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [array0.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2014 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: February, 2014 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"
<span class="keyword">staload</span> "libats/ML/SATS/matrix0.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
matrix0_of_mtrxszref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>matrix0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
mtrxszref_of_matrix0<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>mtrxszref<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span>
<span class="staexp"><span class="keyword">}</span></span> matrix0_get_ref <span class="keyword">(</span>M<span class="keyword">)</span> <span class="keyword">=</span>
  mtrxszref_get_ref <span class="keyword">(</span>mtrxszref_of_matrix0<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
matrix0_get_nrow<span class="keyword">(</span>M<span class="keyword">)</span> <span class="keyword">=</span>
  mtrxszref_get_nrow<span class="keyword">(</span>mtrxszref_of_matrix0<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
matrix0_get_ncol <span class="keyword">(</span>M<span class="keyword">)</span> <span class="keyword">=</span>
  mtrxszref_get_ncol<span class="keyword">(</span>mtrxszref_of_matrix0<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span>
<span class="staexp"><span class="keyword">}</span></span> matrix0_get_refsize
  <span class="keyword">(</span>M<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="comment">// uninitized</span>
<span class="keyword">and</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="comment">// uninitized</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> Mref <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
mtrxszref_get_refsize<span class="keyword">(</span>mtrxszref_of_matrix0<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [val] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span>Mref<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_get_refsize]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_make_elt_int
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
nrow <span class="keyword">=</span> i2sz<span class="keyword">(</span>max<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>nrow<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">and</span>
ncol <span class="keyword">=</span> i2sz<span class="keyword">(</span>max<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>ncol<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrix0_of_mtrxszref<span class="keyword">(</span>mtrxszref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_make_elt_int]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_make_elt_size
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  matrix0_of_mtrxszref<span class="keyword">(</span>mtrxszref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrix0_make_elt_size] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_get_at_int
  <span class="keyword">(</span>M0<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i<span class="keyword">)</span>
  <span class="keyword">and</span> j <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="keyword">if</span> j &gt;= <span class="dynexp">0</span> <span class="keyword">then</span>
  matrix0_get_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>M0<span class="keyword">,</span> i2sz<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span> <span class="comment">// neg index</span>
<span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span> <span class="comment">// neg index</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_get_at_int]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_get_at_size
  <span class="keyword">(</span>M0<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
MSZ <span class="keyword">=</span> mtrxszref_of_matrix0<span class="keyword">(</span>M0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mtrxszref_get_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>MSZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
<span class="comment">// end of [val]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_get_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_set_at_int
  <span class="keyword">(</span>M0<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i<span class="keyword">)</span>
  <span class="keyword">and</span> j <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="keyword">if</span>
j &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span>
  matrix0_set_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>M0<span class="keyword">,</span> i2sz<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span> <span class="comment">(* neg index *)</span>
<span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">else</span>
  <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span> <span class="comment">(* neg index *)</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_set_at_int]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_set_at_size
  <span class="keyword">(</span>M0<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
MSZ <span class="keyword">=</span>
mtrxszref_of_matrix0<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>M0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mtrxszref_set_at_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>MSZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_set_at_size]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
print_matrix0 <span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_matrix0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>stdout_ref<span class="keyword">,</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
prerr_matrix0 <span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_matrix0&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>stderr_ref<span class="keyword">,</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_matrix0<span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_mtrxszref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> mtrxszref_of_matrix0<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_matrix0_sep<span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_mtrxszref_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> mtrxszref_of_matrix0<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_copy<span class="keyword">(</span>M0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span> matrix0_get_ref<span class="keyword">(</span>M0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">]</span> m <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>M0<span class="dynexp"><span class="keyword">.</span>nrow</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">]</span> n <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>M0<span class="dynexp"><span class="keyword">.</span>ncol</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
  matrixref_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>matrixref<span class="keyword">(</span>a<span class="keyword">,</span>m<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">// end of [val]</span>
<span class="keyword">in</span>
<span class="comment">//</span>
matrix0_of_mtrxszref
  <span class="keyword">(</span>mtrxszref_make_matrixref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>matrixptr_refize<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_tabulate
<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span>
<span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix_tabulate$fopr
  <span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>m<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> j <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="keyword">in</span>  
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>i<span class="keyword">,</span>j<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_tabulate$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrix0_of_mtrxszref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>mtrxszref_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_tabulate_method_int
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
matrix0_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">(</span> i2sz<span class="keyword">(</span>nrow<span class="keyword">)</span>
<span class="keyword">,</span> i2sz<span class="keyword">(</span>ncol<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">lam</span><span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=&gt;</span> fopr<span class="keyword">(</span>sz2i<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> sz2i<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_tabulate_method_size
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> matrix0_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_foreach
  <span class="keyword">(</span>M0<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>i <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_vtake<span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> matrix0_get_refsize<span class="keyword">(</span>M0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> m * n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_foreach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_iforeach
  <span class="keyword">(</span>M0<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span>
  matrix0_get_refsize <span class="keyword">(</span>M0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">,</span> k<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>k <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_vtake <span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> k <span class="keyword">=</span> pred<span class="keyword">(</span>k<span class="keyword">)</span> <span class="keyword">and</span> j <span class="keyword">=</span> succ<span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> j <span class="keyword">&lt;</span> n
  <span class="keyword">then</span> loop<span class="keyword">(</span>p<span class="keyword">,</span> k<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
  <span class="keyword">else</span> loop<span class="keyword">(</span>p<span class="keyword">,</span> k<span class="keyword">,</span> succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> m * n<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix0_iforeach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_foldleft
<span class="keyword">(</span>
M0<span class="keyword">,</span> ini<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> ini <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> ini<span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span> ini
<span class="dynexp"><span class="keyword">val</span> p_ini <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>ini<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> fopr2 <span class="keyword">=</span>
<span class="keyword">lam@</span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=&gt;</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>p_ini<span class="keyword">,</span> fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>p_ini<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
matrix0_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>M0<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;a<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span>void<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>fopr2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [matrix0_foldleft] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrix0_ifoldleft
<span class="keyword">(</span>
M0<span class="keyword">,</span> ini<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> ini <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> ini<span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span> ini
<span class="dynexp"><span class="keyword">val</span> p_ini <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>ini<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> fopr2 <span class="keyword">=</span>
<span class="keyword">lam@</span><span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=&gt;</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">res</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>p_ini<span class="keyword">,</span> fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>p_ini<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
matrix0_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">(</span>M0<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>size_t<span class="keyword">,</span>size_t<span class="keyword">,</span>&amp;a<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span>void<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>fopr2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [matrix0_ifoldleft] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrix0.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2016 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: October, 2016 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span>
  
<span class="comment">(* ****** ****** *)</span>
  
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"
<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"
<span class="keyword">staload</span> "libats/ML/SATS/stream.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intgte_stream<span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> f<span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="dynexp"><span class="keyword">fun</span>
f<span class="keyword">(</span>n<span class="keyword">:</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span>
 <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>stream_cons<span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">(</span>n+1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="keyword">}</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream2list0<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
list0_of_list_vt<span class="keyword">(</span>stream2list<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_make_list0
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
stream_make_list0&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_make_list0] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_make_intrange_lr
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
stream_make_intrange_lrd&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> <span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_make_intrange_lrd
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>l &gt;= r<span class="keyword">)</span>
<span class="keyword">then</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">else</span> stream_cons<span class="keyword">(</span>l<span class="keyword">,</span> auxmain<span class="keyword">(</span>l+d<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_make_intrange_lrd]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  stream_map_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_map_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_imap
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  stream_imap_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_imap_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_imap_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_filter
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> stream_filter_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_filter_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_filter_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span>
stream_scan
  <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
stream_scan_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span>
stream_scan_method<span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>res<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_scan_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_foreach
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span>
  stream_foreach_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_foreach_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_foreach_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
  <span class="comment">// end of [lam]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_iforeach
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span>
  stream_iforeach_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_iforeach_method<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_iforeach_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
  <span class="comment">// end of [lam]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_foldleft
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span>
  stream_foldleft_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_foldleft_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="comment">(*TYPE*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_foldleft_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span></span>
  <span class="comment">// end of [lam]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2016 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: October, 2016 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span>
  
<span class="comment">(* ****** ****** *)</span>
  
<span class="keyword">#staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">#staload</span> "libats/ML/SATS/basis.sats"
<span class="keyword">#staload</span> "libats/ML/SATS/list0.sats"
<span class="keyword">#staload</span> "libats/ML/SATS/list0_vt.sats"
<span class="keyword">#staload</span> "libats/ML/SATS/stream_vt.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream2list0_vt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
list0_vt2t
<span class="keyword">(</span>g0ofg1<span class="keyword">(</span>stream2list_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intgte_stream_vt<span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> f<span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="dynexp"><span class="keyword">fun</span>
f<span class="keyword">(</span>n<span class="keyword">:</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span>
 <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>stream_vt_cons<span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">(</span>n+1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="keyword">}</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_make_list0
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
stream_vt_make_list0&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list0_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list0_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_make_list0] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_vt_make_intrange_lr
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
stream_vt_make_intrange_lrd&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> <span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_vt_make_intrange_lrd
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>l &gt;= r<span class="keyword">)</span>
<span class="keyword">then</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">else</span> stream_vt_cons<span class="keyword">(</span>l<span class="keyword">,</span> auxmain<span class="keyword">(</span>l+d<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> d<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_make_intrange_lrd]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_vt_map_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">llam</span><span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_map_cloptr&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_filter_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">llam</span><span class="keyword">(</span>pred<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_filter_cloptr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_foreach_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">llam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_foreach_cloptr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_rforeach_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">llam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_rforeach_cloptr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_iforeach_method
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">llam</span><span class="keyword">(</span>fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_iforeach_cloptr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_vt_foldleft_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="comment">(*TYPE*)</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">llam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_foldleft_cloptr&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_vt_ifoldleft_method
  <span class="keyword">(</span>xs<span class="keyword">,</span> _<span class="comment">(*TYPE*)</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">llam</span><span class="keyword">(</span>ini<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_ifoldleft_cloptr&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream_vt.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: January, 2013 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_DYNLOADFLAG 0</span>
<span class="comment">//</span>
<span class="comment">// no dynloading at run-time</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/integer.dats"
<span class="keyword">staload</span>
_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/integer_size.dats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/filebas.dats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_fileref_get_line_charlst <span class="keyword">=</span>
  fileref_get_line_charlst</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_fileref_get_lines_charlstlst <span class="keyword">=</span>
  fileref_get_lines_charlstlst</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span>
prelude_fileref_get_line_string <span class="keyword">=</span> fileref_get_line_string</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_fileref_get_lines_stringlst <span class="keyword">=</span> fileref_get_lines_stringlst</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_streamize_fileref_char <span class="keyword">=</span> streamize_fileref_char</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_streamize_fileptr_char <span class="keyword">=</span> streamize_fileptr_char</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_streamize_fileref_line <span class="keyword">=</span> streamize_fileref_line</span>
<span class="dynexp"><span class="keyword">macdef</span>
prelude_streamize_fileptr_line <span class="keyword">=</span> streamize_fileptr_line</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"
<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"
<span class="keyword">staload</span> "libats/ML/SATS/option0.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/filebas.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
fileref_open_opt
  (path, mode) = let
//
val
opt =
prelude_fileref_open_opt
  (path, mode)
//
in
  option0_of_option_vt{FILEref}(opt)
end // end of [fileref_open_opt]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get_line_charlst
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
list0_of_list_vt
  <span class="keyword">(</span>prelude_fileref_get_line_charlst<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [fileref_get_line_charlst]</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get_lines_charlstlst
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>list0<span class="keyword">(</span>charlst0<span class="keyword">)</span><span class="keyword">}</span></span>
  <span class="keyword">(</span>prelude_fileref_get_lines_charlstlst<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [fileref_get_lines_charlstlst]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/strptr.dats"
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get_line_string
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
strptr2string
  <span class="keyword">(</span>prelude_fileref_get_line_string<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [fileref_get_line_string]</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get_lines_stringlst
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>list0<span class="keyword">(</span>string<span class="keyword">)</span><span class="keyword">}</span></span>
  <span class="keyword">(</span>prelude_fileref_get_lines_stringlst<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [fileref_get_lines_stringlst]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
filename_get_lines_stringlst_opt
  <span class="keyword">(</span>path<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> opt <span class="keyword">=</span>
  fileref_open_opt<span class="keyword">(</span>path<span class="keyword">,</span> file_mode_r<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
   None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=&gt;</span>
   Some_vt<span class="keyword">(</span>lines<span class="keyword">)</span> <span class="keyword">where</span>
 <span class="keyword">{</span>
    <span class="dynexp"><span class="keyword">val</span> lines <span class="keyword">=</span>
      fileref_get_lines_stringlst<span class="keyword">(</span>inp<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fileref_close<span class="keyword">(</span>inp<span class="keyword">)</span></span>
 <span class="keyword">}</span> <span class="comment">(* end of [Some_vt] *)</span> 
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [filename_get_lines_stringlst_opt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileref_char
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
  prelude_streamize_fileref_char<span class="keyword">(</span>filr<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileptr_char
  <span class="keyword">(</span>filp<span class="keyword">)</span> <span class="keyword">=</span>
  prelude_streamize_fileptr_char<span class="keyword">(</span>filp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileref_line
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>stream_vt<span class="keyword">(</span>string<span class="keyword">)</span><span class="keyword">}</span></span>
  <span class="keyword">(</span>prelude_streamize_fileref_line<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [streamize_fileref_line]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileptr_line
  <span class="keyword">(</span>filp<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>stream_vt<span class="keyword">(</span>string<span class="keyword">)</span><span class="keyword">}</span></span>
  <span class="keyword">(</span>prelude_streamize_fileptr_line<span class="keyword">(</span>filp<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [streamize_fileptr_line]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileref_word
  <span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  filr<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">)</span> <span class="keyword">:</span>
<span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="dynexp"><span class="keyword">$ldelay</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
<span class="comment">//</span>
  <span class="keyword">val</span>
  word <span class="keyword">=</span>
  fileref_get_word&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>filr<span class="keyword">)</span>
  <span class="keyword">val</span> test <span class="keyword">=</span> strptr_is_null<span class="keyword">(</span>word<span class="keyword">)</span>
<span class="comment">//</span>
  <span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strptr_param<span class="keyword">(</span>word<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> test
    <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      strptr_free_null<span class="keyword">(</span>word<span class="keyword">)</span> <span class="keyword">in</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
    <span class="comment">// end of [prval]</span>
    <span class="keyword">end</span> <span class="comment">// end of [then]</span>
    <span class="keyword">else</span> stream_vt_cons<span class="keyword">(</span>strptr2string<span class="keyword">(</span>word<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [streamize_fileref_word] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileptr_word
  <span class="keyword">(</span>filp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  filr<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">)</span> <span class="keyword">:</span>
<span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="dynexp"><span class="keyword">$ldelay</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
<span class="comment">//</span>
  <span class="keyword">val</span>
  word <span class="keyword">=</span>
  fileref_get_word&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>filr<span class="keyword">)</span>
  <span class="keyword">val</span> test <span class="keyword">=</span> strptr_is_null<span class="keyword">(</span>word<span class="keyword">)</span>
<span class="comment">//</span>
  <span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strptr_param<span class="keyword">(</span>word<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> test
    <span class="keyword">then</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
    <span class="keyword">{</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fileref_close<span class="keyword">(</span>filr<span class="keyword">)</span>
      <span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> strptr_free_null<span class="keyword">(</span>word<span class="keyword">)</span>
    <span class="keyword">}</span> <span class="comment">(* end of [then] *)</span>
    <span class="keyword">else</span> stream_vt_cons<span class="keyword">(</span>strptr2string<span class="keyword">(</span>word<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>FILEref<span class="keyword">}</span></span><span class="keyword">(</span>filp<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [streamize_fileptr_word] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_filename_char
  <span class="keyword">(</span>fname<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
opt <span class="keyword">=</span>
fileref_open_opt<span class="keyword">(</span>fname<span class="keyword">,</span> file_mode_r<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
   None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
   Some_vt<span class="keyword">(</span>streamize_fileptr_char<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>FILEptr1<span class="keyword">}</span></span><span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_filename_char]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_filename_line
  <span class="keyword">(</span>fname<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
opt <span class="keyword">=</span>
fileref_open_opt<span class="keyword">(</span>fname<span class="keyword">,</span> file_mode_r<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
   None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
   Some_vt<span class="keyword">(</span>streamize_fileptr_line<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>FILEptr1<span class="keyword">}</span></span><span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_filename_line]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_filename_word
  <span class="keyword">(</span>fname<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
opt <span class="keyword">=</span>
fileref_open_opt<span class="keyword">(</span>fname<span class="keyword">,</span> file_mode_r<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
   None_vt<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>filr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
   Some_vt<span class="keyword">(</span>streamize_fileptr_word<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>FILEptr1<span class="keyword">}</span></span><span class="keyword">(</span>filr<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_filename_word]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [filebas.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: September, 2014 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"
<span class="keyword">staload</span> "libats/ML/SATS/array0.sats"
<span class="keyword">staload</span> "libats/ML/SATS/intrange.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_repeat_lazy
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
int_repeat_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> lazy2cloref<span class="keyword">(</span>f<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_repeat_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
  loop<span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
 n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">cfun0</span><span class="keyword">(</span><span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
n <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="keyword">let</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f<span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> loop<span class="keyword">(</span>n-<span class="dynexp">1</span><span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [int_repeat_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_repeat_method
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_repeat_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_forall_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
  intrange_forall_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_forall_method
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_forall_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_foreach_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
  intrange_foreach_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_foreach_method
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_foreach_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_rforeach_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
  intrange_rforeach_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_rforeach_method
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_rforeach_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_foldleft_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> ini<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
  intrange_foldleft_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> ini<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_foldleft_method
  <span class="keyword">(</span>n<span class="keyword">,</span> tres<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_foldleft_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> ini<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_foldright_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=</span>
  intrange_foldright_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_foldright_method
  <span class="keyword">(</span>n<span class="keyword">,</span> tres<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_foldright_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_forall_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span> l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">bool</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> l <span class="keyword">&lt;</span> r
  <span class="keyword">then</span> <span class="keyword">(</span>
    <span class="keyword">if</span> f<span class="keyword">(</span>l<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>l+<span class="dynexp">1</span><span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">else</span> false
  <span class="keyword">)</span> <span class="keyword">else</span> true
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_forall_cloref]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_forall_method
  <span class="keyword">(</span> <span class="keyword">@(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> intrange_forall_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_foreach_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
 l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>l <span class="keyword">&lt;</span> r<span class="keyword">)</span>
<span class="keyword">then</span>
<span class="keyword">(</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f<span class="keyword">(</span>l<span class="keyword">)</span></span> <span class="keyword">in</span> loop<span class="keyword">(</span>l+<span class="dynexp">1</span><span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">end</span>
<span class="keyword">)</span>
<span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_foreach_cloref]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_foreach_method
  <span class="keyword">(</span> <span class="keyword">@(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> intrange_foreach_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_rforeach_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">cfun1</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>l <span class="keyword">&lt;</span> r<span class="keyword">)</span>
<span class="keyword">then</span>
<span class="keyword">(</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f<span class="keyword">(</span>r-<span class="dynexp">1</span><span class="keyword">)</span></span> <span class="keyword">in</span> loop<span class="keyword">(</span>l<span class="keyword">,</span> r-<span class="dynexp">1</span><span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">end</span>
<span class="keyword">)</span>
<span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_rforeach_cloref]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_rforeach_method
  <span class="keyword">(</span> <span class="keyword">@(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> intrange_rforeach_cloref&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
intrange_foldleft_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>l <span class="keyword">&lt;</span> r<span class="keyword">)</span>
  <span class="keyword">then</span> loop<span class="keyword">(</span>l+<span class="dynexp">1</span><span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">(</span>ini<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">else</span> ini
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> ini<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_foldleft_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
intrange_foldleft_method
  <span class="keyword">(</span> <span class="keyword">@(</span>l<span class="keyword">,</span> r<span class="keyword">)</span><span class="keyword">,</span> tres <span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">lam</span><span class="keyword">(</span>ini<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  intrange_foldleft_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> ini<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [intrange_foldleft_method] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
intrange_foldright_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>l <span class="keyword">&lt;</span> r<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> r1 <span class="keyword">=</span> r-<span class="dynexp">1</span></span> <span class="keyword">in</span> loop<span class="keyword">(</span>l<span class="keyword">,</span> r1<span class="keyword">,</span> f<span class="keyword">,</span> f<span class="keyword">(</span>r1<span class="keyword">,</span> snk<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> snk <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_foldright_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
intrange_foldright_method
  <span class="keyword">(</span> <span class="keyword">@(</span>l<span class="keyword">,</span> r<span class="keyword">)</span><span class="keyword">,</span> tres <span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  intrange_foldright_cloref&lt;<span class="staexp">res</span><span class="keyword">&gt;</span><span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> f<span class="keyword">,</span> snk<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [intrange_foldright_method] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_streamGte<span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">fix</span>
aux
<span class="keyword">(</span>
 n<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>stream_cons<span class="keyword">(</span>n<span class="keyword">,</span> aux<span class="keyword">(</span>n+1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="keyword">(</span>n<span class="keyword">)</span></span> <span class="comment">// end of [int_streamGte]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_streamGte_vt<span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">fix</span>
aux
<span class="keyword">(</span>
 n<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>stream_vt_cons<span class="keyword">(</span>n<span class="keyword">,</span> aux<span class="keyword">(</span>n+1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="keyword">(</span>n<span class="keyword">)</span></span> <span class="comment">// end of [int_streamGte_vt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_list0_map_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> list0_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_list0_map_method
  <span class="keyword">(</span>n<span class="keyword">,</span> tres<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_list0_map_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_array0_map_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
array0_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">lam</span><span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> fopr<span class="keyword">(</span>sz2i<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_array0_map_method
  <span class="keyword">(</span>n<span class="keyword">,</span> tres<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span> int_array0_map_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_stream_map_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
 i<span class="keyword">:</span> <span class="staexp">Nat</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>i &gt;= n<span class="keyword">)</span>
<span class="keyword">then</span>
stream_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="keyword">else</span>
stream_cons<span class="keyword">(</span>f<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>i+1<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [int_stream_map_cloref] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_stream_map_method
  <span class="keyword">(</span>n<span class="keyword">,</span> tres<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  int_stream_map_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* int_stream_map_method *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_stream_vt_map_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
 i<span class="keyword">:</span> <span class="staexp">Nat</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>i &gt;= n<span class="keyword">)</span>
<span class="keyword">then</span>
stream_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="keyword">else</span>
stream_vt_cons<span class="keyword">(</span>f<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>i+1<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [then]</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>a<span class="keyword">)</span></span></span> <span class="comment">// [auxmain]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [int_stream_vt_map_cloref] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
int_stream_vt_map_method
  <span class="keyword">(</span>n<span class="keyword">,</span> tres<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">lam</span><span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  int_stream_vt_map_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int2_foreach_cloref
  <span class="keyword">(</span>n1<span class="keyword">,</span> n2<span class="keyword">,</span> f0<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
intrange2_foreach_cloref&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span> <span class="dynexp">0</span><span class="comment">(*l1*)</span><span class="keyword">,</span> n1<span class="comment">(*r1*)</span>
  <span class="keyword">,</span> <span class="dynexp">0</span><span class="comment">(*l2*)</span><span class="keyword">,</span> n2<span class="comment">(*r2*)</span><span class="keyword">,</span> f0 <span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange2_foreach_cloref
  <span class="keyword">(</span>l1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">,</span> f0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span>
loop1
<span class="keyword">(</span>
  m1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r1<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> l2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r2<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
m1 <span class="keyword">&lt;</span> r1
<span class="keyword">then</span>
loop2<span class="keyword">(</span>m1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">,</span> f0<span class="keyword">)</span>
<span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="comment">(* end of [loop1] *)</span>
<span class="comment">//</span>
<span class="keyword">and</span>
loop2
<span class="keyword">(</span>
  m1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r1<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> l2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> m2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r2<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> f0<span class="keyword">:</span> <span class="staexp">cfun2</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">void</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
m2 <span class="keyword">&lt;</span> r2
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f0<span class="keyword">(</span>m1<span class="keyword">,</span> m2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop2
  <span class="keyword">(</span>m1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> m2+<span class="dynexp">1</span><span class="keyword">,</span> r2<span class="keyword">,</span> f0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span>
<span class="keyword">(</span>
  loop1<span class="keyword">(</span>m1+<span class="dynexp">1</span><span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">,</span> f0<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop2] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop1<span class="keyword">(</span>l1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">,</span> f0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange2_foreach_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [intrange.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: August, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-12:</span>
<span class="comment">// the map implementation is based on AVL trees</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span> FM <span class="keyword">=</span>
"libats/SATS/funmap_avltree.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/funmap.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">assume</span>
map_type<span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>map <span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
compare_key_key <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
$FM<span class="keyword">.</span>compare_key_key <span class="keyword">=</span> compare_key_key&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funmap_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>funmap_nil&lt;<span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funmap_make_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>funmap_make_nil&lt;<span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funmap_is_nil<span class="keyword">(</span>map<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>funmap_is_nil&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funmap_isnot_nil<span class="keyword">(</span>map<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>funmap_isnot_nil&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_size
  <span class="keyword">(</span>map<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>funmap_size&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_search
  <span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span>
  $FM<span class="keyword">.</span>funmap_search_opt&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_insert
  <span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  $FM<span class="keyword">.</span>funmap_insert_opt&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_takeout
  <span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span>
  $FM<span class="keyword">.</span>funmap_takeout_opt&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_remove
  <span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>funmap_remove&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
fprint_funmap
  <span class="keyword">(</span>out<span class="keyword">,</span> map<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FM<span class="keyword">.</span>fprint_funmap$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_funmap$sep&lt;<span class="keyword">&gt;</span></span>
<span class="dynexp"><span class="keyword">implement</span>
$FM<span class="keyword">.</span>fprint_funmap$mapto&lt;<span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_funmap$mapto&lt;<span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>fprint_funmap&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> map<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_funmap]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_funmap$sep<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"; "</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_funmap$mapto<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"-&gt;"</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_foreach_cloref
  <span class="keyword">(</span>map<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
$FM<span class="keyword">.</span>funmap_foreach$fwork&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>k<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>k<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
$FM<span class="keyword">.</span>funmap_foreach_env&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [funmap_foreach_cloref] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_listize
  <span class="keyword">(</span>map<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
list0_of_list_vt
  <span class="keyword">(</span>$FM<span class="keyword">.</span>funmap_listize&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [funmap_listize] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_streamize
  <span class="keyword">(</span>map<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">$effmask_wrt</span>
  <span class="keyword">(</span>$FM<span class="keyword">.</span>funmap_streamize&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>map<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [funmap_streamize] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
funmap_make_module
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$rec</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynlab">nil</span> <span class="keyword">=</span> funmap_nil<span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">}</span></span>
<span class="keyword">,</span>
<span class="dynlab">size</span> <span class="keyword">=</span> funmap_size&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">is_nil</span> <span class="keyword">=</span> funmap_is_nil<span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">}</span></span>
<span class="keyword">,</span>
<span class="dynlab">isnot_nil</span> <span class="keyword">=</span> funmap_isnot_nil<span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">}</span></span>
<span class="keyword">,</span>
<span class="dynlab">search</span> <span class="keyword">=</span> funmap_search&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">insert</span> <span class="keyword">=</span> funmap_insert&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">remove</span> <span class="keyword">=</span> funmap_remove&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">takeout</span> <span class="keyword">=</span> funmap_takeout&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">listize</span> <span class="keyword">=</span> funmap_listize&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">streamize</span> <span class="keyword">=</span> funmap_streamize&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [funmap_make_module] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [funmap.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Start time: December, 2012 *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-12:</span>
<span class="comment">// this set implementation</span>
<span class="comment">// is based on the AVL trees</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
FS <span class="keyword">=</span>
"libats/SATS/funset_avltree.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/funset.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
compare_elt_elt <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
$FS<span class="keyword">.</span>compare_elt_elt <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">assume</span> set_type<span class="keyword">(</span>a<span class="keyword">:</span>t0p<span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>set<span class="keyword">(</span>a<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funset_nil
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_nil<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funset_make_nil
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_make_nil<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_sing
  <span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_sing&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x0<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_make_sing
  <span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_make_sing&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_make_list
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> g1ofg0_list<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_make_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_make_list]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fprint_funset$sep
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_funset
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>fprint_funset$sep&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_funset$sep&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>fprint_funset&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_funset]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funset_is_nil
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_is_nil&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
funset_isnot_nil
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_isnot_nil&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_size<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_is_member
  <span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_is_member&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_is_member]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_isnot_member
  <span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">~</span>funset_is_member&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_insert
  <span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_insert&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_insert]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_remove
  <span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_remove&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_remove]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_getmax_opt <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_getmax_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_getmin_opt <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_getmin_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_takeoutmax_opt <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_takeoutmax_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_takeoutmin_opt <span class="keyword">=</span> $FS<span class="keyword">.</span>funset_takeoutmin_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_union
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_union&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_union]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_intersect
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_intersect&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_intersect]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_differ
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_differ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_differ]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_symdiff
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_symdiff&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_symdiff]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_equal
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_equal&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_equal]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_compare
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_compare&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_compare]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_is_subset
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">=</span> compare_elt_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_is_subset&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_is_subset]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_is_supset
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> funset_is_subset&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs2<span class="keyword">,</span> xs1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_foreach<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  funset_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
funset_foreach_env<span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>funset_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> funset_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_foreach_env]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_foreach_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
$FS<span class="keyword">.</span>funset_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>n<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$FS<span class="keyword">.</span>funset_tabulate$fopr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>natLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $FS<span class="keyword">.</span>funset_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [funset_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_listize
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  list0_of_list_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>$FS<span class="keyword">.</span>funset_listize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* $effmask_wrt *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* funset_listize *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_streamize
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>$FS<span class="keyword">.</span>funset_streamize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
funset_make_module
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$rec</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynlab">nil</span> <span class="keyword">=</span> funset_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span>
<span class="keyword">,</span>
<span class="dynlab">sing</span> <span class="keyword">=</span> funset_sing&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">make_list</span> <span class="keyword">=</span> funset_make_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">size</span> <span class="keyword">=</span> funset_size&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">is_nil</span> <span class="keyword">=</span> funset_is_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span>
<span class="keyword">,</span>
<span class="dynlab">isnot_nil</span> <span class="keyword">=</span> funset_isnot_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span>
<span class="keyword">,</span>
<span class="dynlab">insert</span><span class="keyword">=</span> funset_insert&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">remove</span><span class="keyword">=</span> funset_remove&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">union</span><span class="keyword">=</span> funset_union&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">intersect</span><span class="keyword">=</span> funset_intersect&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">listize</span> <span class="keyword">=</span> funset_listize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">,</span>
<span class="dynlab">streamize</span> <span class="keyword">=</span> funset_streamize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [funset_make_module] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [funset.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: August, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span> HT <span class="keyword">=</span>
"libats/SATS/hashtbl_chain.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/basis.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/ML/SATS/list0.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "libats/SATS/hashfun.sats"
<span class="keyword">staload</span> "libats/ML/SATS/hashtblref.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
{key}(*tmp*)
hash_key = ghash_val&lt;key&gt;
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
equal_key_key <span class="keyword">=</span> gequal_val_val&lt;<span class="staexp">key</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
hash_key&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>key<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> key <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>uint32<span class="keyword">}</span></span><span class="keyword">(</span>key<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ulint<span class="keyword">}</span></span><span class="keyword">(</span>inthash_jenkins&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>key<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [hash_key&lt;int&gt;]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
hash_key&lt;<span class="staexp">uint</span><span class="keyword">&gt;</span> <span class="keyword">(</span>key<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> key <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>uint32<span class="keyword">}</span></span><span class="keyword">(</span>key<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ulint<span class="keyword">}</span></span><span class="keyword">(</span>inthash_jenkins&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>key<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [hash_key&lt;uint&gt;]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: 31 and 37 are top choices</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
hash_key&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>key<span class="keyword">)</span> <span class="keyword">=</span>
  string_hash_multiplier <span class="keyword">(</span><span class="dynexp">31UL</span><span class="keyword">,</span> <span class="dynexp">31415926536UL</span><span class="keyword">,</span> key<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
$HT<span class="keyword">.</span>hash_key <span class="keyword">=</span> hash_key&lt;<span class="staexp">key</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
$HT<span class="keyword">.</span>equal_key_key <span class="keyword">=</span> equal_key_key&lt;<span class="staexp">key</span><span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">castfn</span>
hashtbl_encode
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">$HT<span class="keyword">.</span>hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">castfn</span>
hashtbl_decode
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">$HT<span class="keyword">.</span>hashtbl</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> htencode hashtbl_encode</span>
<span class="neuexp"><span class="keyword">#define</span> htdecode hashtbl_decode</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_make_nil<span class="keyword">(</span>cap<span class="keyword">)</span> <span class="keyword">=</span>
htencode
<span class="keyword">(</span>
$HT<span class="keyword">.</span>hashtbl_make_nil&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>cap<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [htencode] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
hashtbl_get_size
  <span class="keyword">(</span>tbl<span class="keyword">)</span> <span class="keyword">=</span> nitm <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> nitm <span class="keyword">=</span> $HT<span class="keyword">.</span>hashtbl_get_size&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_get_size] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
hashtbl_get_capacity
  <span class="keyword">(</span>tbl<span class="keyword">)</span> <span class="keyword">=</span> cap <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> cap <span class="keyword">=</span> $HT<span class="keyword">.</span>hashtbl_get_capacity&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_get_capacity] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_search
  <span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span> opt <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> opt <span class="keyword">=</span>
  $HT<span class="keyword">.</span>hashtbl_search_opt&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_search] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_search_ref
  <span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span> cptr <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> cptr <span class="keyword">=</span>
  $HT<span class="keyword">.</span>hashtbl_search_ref&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_search_ref] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_insert
  <span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> opt <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> opt <span class="keyword">=</span>
  $HT<span class="keyword">.</span>hashtbl_insert_opt&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* hashtbl_insert *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_insert_any
  <span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  $HT<span class="keyword">.</span>hashtbl_insert_any&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* hashtbl_insert_any *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_takeout
  <span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span> opt <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> opt <span class="keyword">=</span>
  $HT<span class="keyword">.</span>hashtbl_takeout_opt&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_takeout] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_remove
  <span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span> ans <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> $HT<span class="keyword">.</span>hashtbl_remove&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">,</span> k<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_remove] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_takeout_all
  <span class="keyword">(</span>tbl<span class="keyword">)</span> <span class="keyword">=</span> kxs <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> kxs <span class="keyword">=</span> $HT<span class="keyword">.</span>hashtbl_takeout_all&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> kxs <span class="keyword">=</span> list0_of_list_vt<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>key<span class="keyword">,</span>itm<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>kxs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_takeout_all] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
fprint_hashtbl
  <span class="keyword">(</span>out<span class="keyword">,</span> tbl<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
$HT<span class="keyword">.</span>fprint_hashtbl$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_hashtbl$sep&lt;<span class="keyword">&gt;</span></span>
<span class="dynexp"><span class="keyword">implement</span>
$HT<span class="keyword">.</span>fprint_hashtbl$mapto&lt;<span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_hashtbl$mapto&lt;<span class="keyword">&gt;</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode <span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $HT<span class="keyword">.</span>fprint_hashtbl <span class="keyword">(</span>out<span class="keyword">,</span> tbl<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_hashtbl]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_hashtbl$sep<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"; "</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_hashtbl$mapto<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"-&gt;"</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
fprint_hashtbl_sep_mapto
  <span class="keyword">(</span>out<span class="keyword">,</span> tbl<span class="keyword">,</span> sep<span class="keyword">,</span> mapto<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_hashtbl$sep&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint<span class="keyword">(</span>out<span class="keyword">,</span> sep<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_hashtbl$mapto&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint<span class="keyword">(</span>out<span class="keyword">,</span> mapto<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_hashtbl&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> tbl<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_hashtbl_sep_mapto]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_foreach_cloref
  <span class="keyword">(</span>tbl<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
$HT<span class="keyword">.</span>hashtbl_foreach$fwork&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>k<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>k<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
$HT<span class="keyword">.</span>hashtbl_foreach_env&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>tbl<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_foreach_cloref] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_listize0
  <span class="keyword">(</span>tbl<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
hashtbl_takeout_all&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span><span class="keyword">(</span>tbl<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
hashtbl_listize1
  <span class="keyword">(</span>tbl<span class="keyword">)</span> <span class="keyword">=</span> kxs <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">ki <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> tbl <span class="keyword">=</span> htdecode<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> kxs <span class="keyword">=</span> $HT<span class="keyword">.</span>hashtbl_listize1<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>tbl<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> kxs <span class="keyword">=</span> list0_of_list_vt<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>key<span class="keyword">,</span>itm<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>kxs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [hashtbl_listize1] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [hashtblref.dats] *)</span>
</pre>
<!--php-->

</body>
</html>
